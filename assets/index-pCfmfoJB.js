import{r as e,a as t,R as s}from"./vendor-CzsvKnaC.js";import{i as r,g as n,a,b as i,o as l,d as o,c as d,s as c,e as m,R as h,f as x,h as p,q as u,l as g,j as y,k as j,m as f,n as b,u as v,p as w,r as N,t as S,v as C,w as k}from"./firebase-D6GTKESH.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var z={exports:{}},B={},F=e,E=Symbol.for("react.element"),R=Symbol.for("react.fragment"),M=Object.prototype.hasOwnProperty,D=F.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,I={key:!0,ref:!0,__self:!0,__source:!0};function L(e,t,s){var r,n={},a=null,i=null;for(r in void 0!==s&&(a=""+s),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(i=t.ref),t)M.call(t,r)&&!I.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===n[r]&&(n[r]=t[r]);return{$$typeof:E,type:e,key:a,ref:i,props:n,_owner:D.current}}B.Fragment=R,B.jsx=L,B.jsxs=L,z.exports=B;var W=z.exports,T={},O=t;T.createRoot=O.createRoot,T.hydrateRoot=O.hydrateRoot;const P={apiKey:"AIzaSyAmWH_Vwhrok_r_lUsjgT2V_P_d63Dly98",authDomain:"construction-da7de.firebaseapp.com",projectId:"construction-da7de",storageBucket:"construction-da7de.firebasestorage.app",messagingSenderId:"557692258606",appId:"1:557692258606:web:283a05beed9e7079fad2bf"},A=r(P),_=n(A),U=a(A),V=i(A),H=e.createContext(),q=()=>{const t=e.useContext(H);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},$=({children:t})=>{const[r,n]=e.useState(null),[a,i]=e.useState(!0),u=s.useRef({});e.useEffect(()=>{const e=sessionStorage.getItem("current_user_session");if(e)try{const t=JSON.parse(e);return n(t),void i(!1)}catch(t){}i(!1)},[]),e.useEffect(()=>{if(!_)return;if(sessionStorage.getItem("current_user_session"))return;return l(_,async e=>{if(e)try{const s=o(U,"users",e.uid),r=new Promise((e,t)=>setTimeout(()=>t(new Error("Firestore timeout")),15e3)),a=await Promise.race([d(s),r]);let l="Member";if(a.exists())l=a.data().role;else try{await c(o(U,"users",e.uid),{email:e.email||"",phoneNumber:e.phoneNumber||"",role:"Member",createdAt:(new Date).toISOString()})}catch(t){}const m={uid:e.uid,email:e.email,phoneNumber:e.phoneNumber,role:l,name:e.displayName||(e.email?e.email.split("@")[0]:e.phoneNumber||"User")};sessionStorage.setItem("current_user_session",JSON.stringify(m)),u.current[e.uid]=m,n(m),i(!1)}catch(s){i(!1)}else{sessionStorage.getItem("current_user_session")||n(null),i(!1)}})},[]);const g={user:r,signupEmail:async(e,t,s)=>{if(!_)throw new Error("Firebase not configured");const r=await p(_,e,t),a=s&&"CEO123"===s?"CEO":"Member";await c(o(U,"users",r.user.uid),{email:e,role:a,createdAt:(new Date).toISOString()});const i={uid:r.user.uid,email:e,role:a,name:e.split("@")[0]};return sessionStorage.setItem("current_user_session",JSON.stringify(i)),u.current[r.user.uid]=i,n(i),r.user},loginEmail:async(e,t)=>{if(!_)throw new Error("Firebase not configured");const s=await x(_,e,t),r=o(U,"users",s.user.uid),a=await d(r),i=a.exists()?a.data().role:"Member",l={uid:s.user.uid,email:s.user.email,role:i,name:s.user.displayName||e.split("@")[0]};return sessionStorage.setItem("current_user_session",JSON.stringify(l)),u.current[s.user.uid]=l,n(l),s.user},setupRecaptcha:e=>{if(!_)throw new Error("Firebase not configured");if(!window.recaptchaVerifier)try{window.recaptchaVerifier=new h(_,e,{size:"invisible",callback:e=>{}})}catch(t){}},sendPhoneOtp:async e=>{if(!_)throw new Error("Firebase not configured");const t=window.recaptchaVerifier;return m(_,e,t)},logout:async()=>{try{sessionStorage.removeItem("current_user_session"),sessionStorage.removeItem("temp_role"),n(null),i(!1)}catch(e){throw e}},isCEO:()=>"CEO"===r?.role,upgradeToCEO:async e=>{if(!_.currentUser)return!1;if("CEO123"!==e.trim())return!1;try{const e=new Promise((e,t)=>setTimeout(()=>t(new Error("Firestore update timed out")),1e4));return await Promise.race([c(o(U,"users",_.currentUser.uid),{role:"CEO",updatedAt:(new Date).toISOString()},{merge:!0}),e]),n(e=>{const t={...e,role:"CEO"};return u.current[_.currentUser.uid]=t,sessionStorage.setItem("current_user_session",JSON.stringify(t)),t}),sessionStorage.removeItem("temp_role"),!0}catch(t){return n(e=>{const t={...e,role:"CEO"};return u.current[_.currentUser.uid]=t,sessionStorage.setItem("current_user_session",JSON.stringify(t)),t}),t.message.includes("timed out")?alert("âš ï¸ Backend Connection Failed!\n\nI have upgraded you to CEO LOCALLY so you can continue working.\n\nTo fix the backend permanently:\n1. Go to Firebase Console > Firestore Database\n2. Click 'Create Database'"):alert("âš ï¸ Update failed: "+t.message+"\n\nSwitched to Offline CEO Mode."),!0}},loading:a};return W.jsx(H.Provider,{value:g,children:t})},Y=({size:e=20,style:t={}})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",style:t,children:[W.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),W.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),J=()=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M2 6h20v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6Z"}),W.jsx("path",{d:"M17 16v5"}),W.jsx("path",{d:"M7 16v5"}),W.jsx("path",{d:"M12 16v5"}),W.jsx("path",{d:"M17 3v3"}),W.jsx("path",{d:"M7 3v3"}),W.jsx("path",{d:"M12 3v3"}),W.jsx("path",{d:"m10 16 4-10"}),W.jsx("path",{d:"m14 16-4-10"})]}),G=()=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",ry:"2"}),W.jsx("path",{d:"M9 22v-4h6v4"}),W.jsx("path",{d:"M8 6h.01"}),W.jsx("path",{d:"M16 6h.01"}),W.jsx("path",{d:"M8 10h.01"}),W.jsx("path",{d:"M16 10h.01"}),W.jsx("path",{d:"M8 14h.01"}),W.jsx("path",{d:"M16 14h.01"}),W.jsx("path",{d:"M12 6h.01"}),W.jsx("path",{d:"M12 10h.01"}),W.jsx("path",{d:"M12 14h.01"})]}),X=()=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M3 6h18"}),W.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),W.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),W.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),W.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),K=()=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M5 12h14"}),W.jsx("path",{d:"M12 5v14"})]}),Z=()=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),W.jsx("polyline",{points:"7 10 12 15 17 10"}),W.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),Q=()=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("circle",{cx:"11",cy:"11",r:"8"}),W.jsx("path",{d:"m21 21-4.3-4.3"})]}),ee=()=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),W.jsx("circle",{cx:"12",cy:"13",r:"3"})]}),te=()=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),W.jsx("polyline",{points:"16 17 21 12 16 7"}),W.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),se=()=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),W.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),re=()=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17"}),W.jsx("polyline",{points:"16 7 22 7 22 13"})]}),ne=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),W.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),W.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),W.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),ae=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),W.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),ie=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24"}),W.jsx("path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"}),W.jsx("path",{d:"M6.61 6.61A13.52 13.52 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"}),W.jsx("line",{x1:"2",y1:"2",x2:"22",y2:"22"})]}),le=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("circle",{cx:"12",cy:"12",r:"10"}),W.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),W.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),oe=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"m12 19-7-7 7-7"}),W.jsx("path",{d:"M19 12H5"})]}),de=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"}),W.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),ce=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),W.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),W.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),W.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),W.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),W.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),me=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),W.jsx("polyline",{points:"14 2 14 8 20 8"})]}),he=({size:e=20})=>W.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:W.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})}),xe=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),W.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),pe=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4"}),W.jsx("path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5"}),W.jsx("path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z"})]}),ue=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1z"}),W.jsx("path",{d:"M16 8h-6M16 12h-6M16 16h-6"})]}),ge=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),W.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),ye=({size:e=20})=>W.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:W.jsx("polyline",{points:"20 6 9 17 4 12"})}),je=({size:e=20})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[W.jsx("path",{d:"M4 7h16"}),W.jsx("path",{d:"M4 17h16"}),W.jsx("path",{d:"M4 21h16a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2z"}),W.jsx("path",{d:"M8 3v4"}),W.jsx("path",{d:"M16 3v4"}),W.jsx("path",{d:"M12 7v10"}),W.jsx("path",{d:"M8 17v4"}),W.jsx("path",{d:"M16 17v4"})]}),fe=({size:e=20,style:t={}})=>W.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",style:t,children:[W.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),W.jsx("polyline",{points:"2 17 12 22 22 17"}),W.jsx("polyline",{points:"2 12 12 17 22 12"})]}),be=s.memo(()=>{const[t,s]=e.useState("email"),[r,n]=e.useState(!1),[a,i]=e.useState(""),[l,o]=e.useState(""),[d,c]=e.useState(!1),[m,h]=e.useState(""),[x,p]=e.useState(""),[u,g]=e.useState(""),[y,j]=e.useState("input"),[f,b]=e.useState(null),[v,w]=e.useState(""),[N,S]=e.useState(!1),[C,k]=e.useState(!P.apiKey),{loginEmail:z,signupEmail:B,setupRecaptcha:F,sendPhoneOtp:E}=q();e.useEffect(()=>{if("phone"===t&&"input"===y)try{F("recaptcha-container")}catch(e){}},[t,y]);return W.jsxs("div",{className:"tiled-background",children:[W.jsxs("div",{className:"glass-card fade-in",children:[C&&W.jsxs("div",{style:{border:"2px solid var(--danger-color)",padding:"1rem",borderRadius:"var(--radius-md)",marginBottom:"1.5rem",background:"#fef2f2"},children:[W.jsxs("h3",{style:{color:"var(--danger-color)",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"8px",fontSize:"1rem"},children:[W.jsx(le,{size:20})," Configuration Required"]}),W.jsxs("p",{style:{fontSize:"0.875rem",marginBottom:"1rem",color:"var(--danger-color)"},children:["Missing Firebase credentials in ",W.jsx("code",{children:".env"})," file."]}),W.jsx("button",{onClick:()=>k(!1),className:"btn btn-secondary",style:{width:"100%",padding:"0.5rem"},children:"Retry Connection"})]}),W.jsxs("div",{className:"text-center mb-lg",children:[W.jsx("div",{style:{color:"var(--primary-color)",marginBottom:"1rem",display:"flex",justifyContent:"center"},children:W.jsx("div",{style:{background:"var(--bg-main)",padding:"1rem",borderRadius:"50%",boxShadow:"var(--shadow-sm)"},children:W.jsx(J,{size:48})})}),W.jsx("h1",{style:{marginBottom:"0.5rem",fontSize:"2rem",letterSpacing:"-0.03em",color:"var(--primary-dark)"},children:"BR CONSTRUCTION"}),W.jsx("p",{className:"text-secondary",style:{fontSize:"1rem"},children:r?"Join the team and start building.":"Welcome back to the site."})]}),W.jsxs("div",{className:"flex mb-lg",style:{background:"var(--bg-main)",borderRadius:"var(--radius-md)",padding:"4px"},children:[W.jsx("button",{type:"button",className:"btn",style:{flex:1,background:"email"===t?"white":"transparent",boxShadow:"email"===t?"var(--shadow-sm)":"none",color:"email"===t?"var(--primary-color)":"var(--text-secondary)",border:"none",borderRadius:"var(--radius-sm)",fontWeight:600},onClick:()=>{s("email"),w("")},children:"Email"}),W.jsx("button",{type:"button",className:"btn",style:{flex:1,background:"phone"===t?"white":"transparent",boxShadow:"phone"===t?"var(--shadow-sm)":"none",color:"phone"===t?"var(--primary-color)":"var(--text-secondary)",border:"none",borderRadius:"var(--radius-sm)",fontWeight:600},onClick:()=>{s("phone"),w("")},children:"Phone"})]}),"email"===t&&W.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(""),S(!0);try{r?await B(a,l,u):await z(a,l)}catch(t){w(t.message.replace("Firebase: ",""))}S(!1)},children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{style:{marginBottom:"0.5rem",display:"block",fontWeight:600},children:"Email Address"}),W.jsx("input",{type:"email",placeholder:"name@company.com",value:a,onChange:e=>i(e.target.value),required:!0,style:{padding:"0.75rem 1rem",background:"#f8fafc"}})]}),W.jsxs("div",{className:"input-group",children:[W.jsx("label",{style:{marginBottom:"0.5rem",display:"block",fontWeight:600},children:"Password"}),W.jsxs("div",{style:{position:"relative"},children:[W.jsx("input",{type:d?"text":"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:l,onChange:e=>o(e.target.value),required:!0,style:{paddingRight:"40px",padding:"0.75rem 1rem",paddingRight:"40px",background:"#f8fafc"}}),W.jsx("button",{type:"button",onClick:()=>c(!d),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:d?W.jsx(ie,{size:18}):W.jsx(ae,{size:18})})]})]}),r&&W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"CEO Access Code (Optional)"}),W.jsx("input",{type:"text",placeholder:"Enter code for administrative access",value:u,onChange:e=>g(e.target.value),style:{padding:"0.75rem 1rem",background:"#f8fafc"}})]}),v&&W.jsx("div",{className:"text-danger mb-md",style:{fontSize:"0.875rem"},children:v}),W.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%",marginTop:"0.5rem",padding:"0.875rem",fontWeight:600},disabled:N,children:N?W.jsx("span",{className:"loading-spinner-small"}):r?"Create Account":"Sign In"})]}),"phone"===t&&"input"===y&&W.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(""),S(!0);try{const e=await E(m);b(e),j("verify")}catch(t){let e=t.message.replace("Firebase: ","");(e.includes("billing")||e.includes("quota"))&&(e="âš ï¸ SMS limit reached or billing not enabled. Please use a TEST PHONE NUMBER defined in Firebase Console."),w(e)}S(!1)},children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{style:{marginBottom:"0.5rem",display:"block",fontWeight:600},children:"Phone Number"}),W.jsx("input",{type:"tel",placeholder:"+91 98765 43210",value:m,onChange:e=>h(e.target.value),required:!0,style:{padding:"0.75rem 1rem",background:"#f8fafc"}})]}),W.jsx("div",{id:"recaptcha-container",style:{marginBottom:"1rem"}}),v&&W.jsx("div",{className:"text-danger mb-md",style:{fontSize:"0.875rem"},children:v}),W.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%",padding:"0.875rem",fontWeight:600},disabled:N,children:N?W.jsx("span",{className:"loading-spinner-small"}):"Send Verification Code"})]}),"phone"===t&&"verify"===y&&W.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(""),S(!0);try{await f.confirm(x)}catch(t){w(t.message.replace("Firebase: ",""))}S(!1)},children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{style:{marginBottom:"0.5rem",display:"block",fontWeight:600},children:"Verification Code"}),W.jsx("input",{type:"text",placeholder:"000000",value:x,onChange:e=>p(e.target.value),required:!0,style:{textAlign:"center",letterSpacing:"8px",fontSize:"1.25rem",fontWeight:700,padding:"0.75rem",background:"#f8fafc"}})]}),v&&W.jsx("div",{className:"text-danger mb-md",style:{fontSize:"0.875rem"},children:v}),W.jsx("button",{type:"submit",className:"btn btn-success",style:{width:"100%",padding:"0.875rem",fontWeight:600},disabled:N,children:N?W.jsx("span",{className:"loading-spinner-small"}):"Verify & Sign In"}),W.jsx("button",{type:"button",className:"btn btn-secondary",style:{width:"100%",marginTop:"0.75rem"},onClick:()=>j("input"),children:"Back"})]}),"email"===t&&W.jsx("div",{className:"text-center mt-lg",children:W.jsx("button",{className:"text-primary",style:{background:"none",border:"none",cursor:"pointer",fontSize:"0.9375rem",fontWeight:600},onClick:()=>n(!r),children:r?"Already have an account? Sign In":"Need an account? Create one"})})]}),N&&W.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(15, 23, 42, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,flexDirection:"column",color:"white",backdropFilter:"blur(8px)"},children:[W.jsx("div",{className:"loading-spinner",style:{marginBottom:"1.5rem"}}),W.jsx("h2",{style:{marginBottom:"0.5rem"},children:"Authenticating..."}),W.jsx("p",{style:{opacity:.7},children:"Please wait while we verify your credentials."})]})]})}),ve=()=>{const[t,s]=e.useState(""),[r,n]=e.useState(""),[a,i]=e.useState(""),[l,o]=e.useState(""),[d,c]=e.useState(""),m=30.48,h=304.8,x=.3048,p=({label:e,value:t,onChange:s,color:r,size:n="medium"})=>W.jsx("div",{className:"circle-wrapper",children:W.jsxs("div",{className:`circle-input circle-size-${n}`,style:{border:`3px solid ${r}`},children:[W.jsx("label",{style:{color:r},children:e}),W.jsx("input",{type:"number",value:t,onChange:e=>s(e.target.value),placeholder:"0",step:"any"})]})});return W.jsxs("div",{className:"card mb-lg",style:{background:"linear-gradient(135deg, #f6f8fb 0%, #ffffff 100%)"},children:[W.jsxs("div",{className:"flex-between mb-md",children:[W.jsxs("h3",{className:"flex",style:{alignItems:"center",gap:"0.5rem",margin:0},children:[W.jsx(re,{size:24,style:{transform:"rotate(45deg)"}})," Measurement Converter"]}),W.jsx("button",{onClick:()=>{s(""),n(""),i(""),o(""),c("")},className:"btn btn-secondary btn-small",children:"Clear All"})]}),W.jsxs("div",{className:"converter-container",children:[W.jsx("div",{style:{position:"relative"},children:W.jsx(p,{label:"Inches",value:r,onChange:e=>{const t=parseFloat(e)||0;n(e);const r=t/12;s(t>0?r.toFixed(4):""),i(t>0?(r*m).toFixed(2):""),o(t>0?(r*h).toFixed(2):""),c(t>0?(r*x).toFixed(4):"")},color:"#FF6B6B"})}),W.jsxs("div",{className:"converter-row",children:[W.jsx(p,{label:"CM",value:a,onChange:e=>{const t=parseFloat(e)||0;i(e);const r=t/m;s(t>0?r.toFixed(4):""),n(t>0?(12*r).toFixed(2):""),o(t>0?(r*h).toFixed(2):""),c(t>0?(r*x).toFixed(4):"")},color:"#4ECDC4"}),W.jsx(p,{label:"FEET",value:t,onChange:e=>{const t=parseFloat(e)||0;s(e),n(t>0?(12*t).toFixed(2):""),i(t>0?(t*m).toFixed(2):""),o(t>0?(t*h).toFixed(2):""),c(t>0?(t*x).toFixed(4):"")},color:"var(--primary-color)",size:"large"}),W.jsx(p,{label:"MM",value:l,onChange:e=>{const t=parseFloat(e)||0;o(e);const r=t/h;s(t>0?r.toFixed(4):""),n(t>0?(12*r).toFixed(2):""),i(t>0?(r*m).toFixed(2):""),c(t>0?(r*x).toFixed(4):"")},color:"#FFD93D"})]}),W.jsx("div",{style:{position:"relative"},children:W.jsx(p,{label:"Meters",value:d,onChange:e=>{const t=parseFloat(e)||0;c(e);const r=t/x;s(t>0?r.toFixed(4):""),n(t>0?(12*r).toFixed(2):""),i(t>0?(r*m).toFixed(2):""),o(t>0?(r*h).toFixed(2):"")},color:"#6BCB77"})}),W.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",opacity:.1,zIndex:0},children:W.jsx("circle",{cx:"50%",cy:"50%",r:"120",fill:"none",stroke:"var(--primary-color)",strokeWidth:"2",strokeDasharray:"5,5"})})]}),W.jsx("div",{className:"text-center text-secondary",style:{fontSize:"0.75rem",marginTop:"1rem"},children:"ðŸ’¡ Tip: Type a value in any circle to convert instantly!"})]})},we=()=>{const[t,s]=e.useState([]),[r,n]=e.useState([]),[a,i]=e.useState(!1),[l,o]=e.useState(!1),[d,c]=e.useState(0),[m,h]=e.useState("feet"),[x,p]=e.useState("sqft"),[u,g]=e.useState([]),[y,j]=e.useState([]),f=e.useRef(null),[b,v]=e.useState(null),[w,N]=e.useState(null),S=(e,t)=>e*{sqft:1,sqm:.092903,cent:.00229568,acre:229568e-10}[t],C=e=>{if(e.length<3)return 0;const t=[];let s={x:0,y:0},r=0;e.forEach((e,n)=>{t.push({...s});const a=e.path;if(a.length>1){const e=a[a.length-1].x-a[0].x,t=a[a.length-1].y-a[0].y;r=Math.atan2(t,e)}const i=(l=e.length,o=e.unit,parseFloat(l)*{feet:1,meter:3.28084,cm:.0328084,inch:.0833333}[o]);var l,o;s={x:s.x+i*Math.cos(r),y:s.y+i*Math.sin(r)}});let n=0;for(let a=0;a<t.length;a++){const e=(a+1)%t.length;n+=t[a].x*t[e].y,n-=t[e].x*t[a].y}return Math.abs(n/2)};e.useEffect(()=>{(()=>{const e=f.current;if(!e)return;const s=e.getContext("2d");s.clearRect(0,0,e.width,e.height),s.strokeStyle="#e2e8f0",s.lineWidth=1;for(let t=0;t<e.width;t+=20)s.beginPath(),s.moveTo(t,0),s.lineTo(t,e.height),s.stroke();for(let t=0;t<e.height;t+=20)s.beginPath(),s.moveTo(0,t),s.lineTo(e.width,t),s.stroke();b&&t.length>0&&(s.fillStyle="rgba(16, 185, 129, 0.3)",s.beginPath(),s.arc(b.x,b.y,20,0,2*Math.PI),s.fill(),s.fillStyle="var(--success-color)",s.beginPath(),s.arc(b.x,b.y,6,0,2*Math.PI),s.fill()),t.forEach((e,t)=>{if(s.strokeStyle=w===t?"var(--accent-color)":"var(--primary-color)",s.lineWidth=w===t?4:3,s.lineCap="round",s.lineJoin="round",e.path.length>0){if(s.beginPath(),s.moveTo(e.path[0].x,e.path[0].y),e.path.forEach(e=>{s.lineTo(e.x,e.y)}),s.stroke(),e.length&&parseFloat(e.length)>0){const r=Math.floor(e.path.length/2),n=e.path[r],a=w===t?"var(--accent-color)":"rgba(255, 255, 255, 0.95)",i=w===t?"white":"var(--success-color)";s.fillStyle=a,s.fillRect(n.x-35,n.y-14,70,28),s.strokeStyle="var(--primary-color)",s.lineWidth=1,s.strokeRect(n.x-35,n.y-14,70,28),s.fillStyle=i,s.font="bold 12px Inter",s.textAlign="center",s.fillText(`${e.length} ${e.unit}`,n.x,n.y+4)}const r=e.path[0];s.fillStyle="rgba(59, 130, 246, 0.15)",s.beginPath(),s.arc(r.x,r.y,25,0,2*Math.PI),s.fill(),s.fillStyle="var(--accent-color)",s.beginPath(),s.arc(r.x,r.y,5,0,2*Math.PI),s.fill();const n=e.path[e.path.length-1];s.fillStyle="rgba(59, 130, 246, 0.15)",s.beginPath(),s.arc(n.x,n.y,25,0,2*Math.PI),s.fill(),s.fillStyle="var(--accent-color)",s.beginPath(),s.arc(n.x,n.y,5,0,2*Math.PI),s.fill()}}),r.length>0&&(s.strokeStyle="rgba(59, 130, 246, 0.6)",s.lineWidth=3,s.lineCap="round",s.lineJoin="round",s.beginPath(),s.moveTo(r[0].x,r[0].y),r.forEach(e=>{s.lineTo(e.x,e.y)}),s.stroke())})()},[t,r,b,w]);const k=e=>{const t=f.current,s=t.getBoundingClientRect(),r=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,a=t.width/s.width,i=t.height/s.height;return{x:(r-s.left)*a,y:(n-s.top)*i}},z=e=>{if(!a)return;e.preventDefault();const s=k(e);0===t.length&&v(s),n([s])},B=e=>{if(!a||0===r.length)return;e.preventDefault();const t=k(e);n(e=>[...e,t])},F=e=>{if(!a||0===r.length)return;e.preventDefault();const i=r[0];let l=r[r.length-1];const o=[];b&&t.length>0&&o.push({point:b}),t.forEach(e=>{e.path&&e.path.length>0&&(o.push({point:e.path[0]}),o.push({point:e.path[e.path.length-1]}))});for(const t of o){if(Math.sqrt(Math.pow(l.x-t.point.x,2)+Math.pow(l.y-t.point.y,2))<50){l=t.point;break}}const d=[i,l];s(e=>[...e,{path:d,length:"",unit:m}]),n([])},E=()=>{s([]),n([]),c(0),i(!1),o(!1),v(null),g([]),j([]),N(null)};return W.jsxs("div",{className:"card mb-lg",style:{background:"linear-gradient(135deg, #f6f8fb 0%, #ffffff 100%)"},children:[W.jsxs("div",{className:"flex-between mb-md",children:[W.jsxs("h3",{className:"flex",style:{alignItems:"center",gap:"0.5rem",margin:0},children:[W.jsx(G,{size:24})," Area Calculator"]}),W.jsx("button",{onClick:E,className:"btn btn-secondary btn-small",children:"Clear All"})]}),W.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[W.jsxs("div",{className:"flex gap-sm",style:{flexWrap:"wrap",alignItems:"center"},children:[W.jsxs("div",{className:"flex gap-sm",style:{alignItems:"center"},children:[W.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600},children:"Input Unit:"}),W.jsxs("select",{value:m,onChange:e=>h(e.target.value),style:{padding:"0.5rem",borderRadius:"6px",fontSize:"0.875rem"},children:[W.jsx("option",{value:"feet",children:"Feet"}),W.jsx("option",{value:"meter",children:"Meters"}),W.jsx("option",{value:"cm",children:"Centimeters"}),W.jsx("option",{value:"inch",children:"Inches"})]})]}),W.jsxs("div",{className:"flex gap-sm",style:{alignItems:"center"},children:[W.jsx("label",{style:{fontSize:"0.875rem",fontWeight:600},children:"Result Unit:"}),W.jsxs("select",{value:x,onChange:e=>p(e.target.value),style:{padding:"0.5rem",borderRadius:"6px",fontSize:"0.875rem"},children:[W.jsx("option",{value:"sqft",children:"Square Feet (sq.ft)"}),W.jsx("option",{value:"sqm",children:"Square Meters (sq.m)"}),W.jsx("option",{value:"cent",children:"Cent"}),W.jsx("option",{value:"acre",children:"Acre"})]})]})]}),W.jsx("canvas",{ref:f,width:600,height:400,onMouseDown:z,onMouseMove:B,onMouseUp:F,onTouchStart:z,onTouchMove:B,onTouchEnd:F,style:{border:"3px solid var(--border-color)",borderRadius:"12px",cursor:a?"crosshair":"default",maxWidth:"100%",background:"white",touchAction:"none"}}),l&&W.jsxs("div",{className:"card",style:{padding:"1.5rem",background:"white",border:"2px solid var(--primary-color)"},children:[W.jsx("h4",{style:{margin:0,marginBottom:"1rem",color:"var(--primary-color)"},children:"ðŸ“ Review & Edit Dimensions"}),W.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",maxHeight:"200px",overflowY:"auto"},children:t.map((e,t)=>{return W.jsxs("div",{className:"flex gap-sm",style:{alignItems:"center"},children:[W.jsxs("span",{style:{fontWeight:600,minWidth:"70px"},children:["Side ",t+1,":"]}),W.jsx("input",{type:"number",value:e.length,onChange:e=>((e,t)=>{s(s=>{const r=[...s];return r[e].length=t,r})})(t,e.target.value),onFocus:()=>N(t),onBlur:()=>N(null),placeholder:"Enter length",style:{flex:1,padding:"0.5rem"}}),W.jsx("span",{style:{minWidth:"80px"},children:(r=m,{feet:"feet",meter:"meters (m)",cm:"centimeters (cm)",inch:"inches (in)"}[r])})]},t);var r})}),W.jsxs("button",{onClick:()=>{if(t.some(e=>!e.length||parseFloat(e.length)<=0))return void alert("Please enter valid lengths for all sides");const e=C(t);c(e),o(!1)},className:"btn btn-success",style:{marginTop:"1rem",width:"100%"},children:[W.jsx(ye,{size:18})," Calculate Area"]})]}),W.jsx("div",{className:"flex gap-sm",style:{flexWrap:"wrap"},children:a||l||d?a?W.jsxs(W.Fragment,{children:[W.jsxs("div",{style:{padding:"0.75rem 1rem",background:"rgba(59, 130, 246, 0.1)",borderRadius:"8px",fontWeight:600,flex:1,fontSize:"0.875rem"},children:["âœï¸ Draw sides | ðŸ§² Snap to corners | Sides: ",t.length]}),t.length>0&&W.jsx("button",{onClick:()=>{if(0===t.length)return;const e=t[t.length-1];g(t=>[...t,e]),s(e=>e.slice(0,-1))},className:"btn btn-secondary",title:"Undo last line",children:"â†¶ Undo"}),u.length>0&&W.jsx("button",{onClick:()=>{if(0===u.length)return;const e=u[u.length-1];s(t=>[...t,e]),g(e=>e.slice(0,-1))},className:"btn btn-secondary",title:"Redo",children:"â†· Redo"}),t.length>=3&&W.jsxs("button",{onClick:()=>{t.length<3?alert("Need at least 3 sides to calculate area"):(i(!1),o(!0))},className:"btn btn-success",children:[W.jsx(ye,{size:18})," Done Drawing"]})]}):null:W.jsxs("button",{onClick:()=>{E(),i(!0)},className:"btn btn-primary",children:[W.jsx(K,{size:18})," Start Drawing"]})}),d>0&&W.jsxs("div",{className:"card",style:{background:"var(--success-color)",color:"white",padding:"1.5rem"},children:[W.jsx("h2",{style:{margin:0,marginBottom:"0.5rem"},children:"ðŸ“ Total Area"}),W.jsxs("div",{style:{fontSize:"2.5rem",fontWeight:"bold"},children:[S(d,x).toFixed(4)," ",(R=x,{sqft:"sq.ft",sqm:"sq.m",cent:"cent",acre:"acre"}[R])]}),W.jsxs("div",{style:{fontSize:"0.875rem",opacity:.8,marginTop:"0.5rem"},children:["= ",d.toFixed(2)," sq.ft | ",S(d,"sqm").toFixed(2)," sq.m"]})]}),W.jsx("div",{className:"text-center text-secondary",style:{fontSize:"0.75rem"},children:"ðŸ’¡ Tip: Draw all sides first, then enter dimensions, finally calculate area!"})]})]});var R},Ne=()=>{const[t,s]=e.useState(""),[r,n]=e.useState(""),[a,i]=e.useState("9"),[l,o]=e.useState("feet"),[d,c]=e.useState("0"),[m,h]=e.useState("1:6"),[x,p]=e.useState("190"),[u,g]=e.useState("90"),[y,j]=e.useState("90"),[f,b]=e.useState(null),v=e.useRef(null),[w,N]=e.useState(null);return W.jsx("div",{className:"fade-in",children:W.jsxs("div",{className:"card mb-lg",style:{borderTop:"4px solid var(--primary-color)"},children:[W.jsx("div",{className:"flex-between mb-md",children:W.jsxs("div",{className:"flex gap-md",children:[W.jsx("div",{className:"text-primary",children:W.jsx(je,{size:28})}),W.jsxs("div",{children:[W.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:"Brick Calculator"}),W.jsx("p",{className:"text-secondary",style:{fontSize:"0.875rem"},children:"Estimate bricks, cement & sand"})]})]})}),W.jsxs("div",{style:{display:"grid",gridTemplateColumns:f?"1fr 1fr":"1fr",gap:"2rem"},children:[W.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[W.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"1rem",borderRadius:"8px"},children:[W.jsxs("div",{className:"flex-between mb-sm",children:[W.jsx("label",{style:{fontWeight:600},children:"Reference Plan (Local View)"}),W.jsx("button",{onClick:()=>v.current.click(),className:"btn btn-secondary btn-small",children:f?"Change Plan":"Select Plan"}),W.jsx("input",{type:"file",ref:v,onChange:e=>{const t=e.target.files[0];if(t){const e=URL.createObjectURL(t);b(e)}},accept:"image/*,application/pdf",style:{display:"none"}})]}),!f&&W.jsx("p",{className:"text-muted",style:{fontSize:"0.8rem"},children:"Select a 2D plan from your device to view it side-by-side while calculating. Nothing is uploaded."})]}),W.jsxs("div",{children:[W.jsx("h4",{className:"mb-sm text-primary",children:"1. Wall Dimensions"}),W.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Total Length"}),W.jsxs("div",{className:"flex",children:[W.jsx("input",{type:"number",value:t,onChange:e=>s(e.target.value),placeholder:"0",style:{borderTopRightRadius:0,borderBottomRightRadius:0}}),W.jsxs("select",{value:l,onChange:e=>o(e.target.value),style:{width:"80px",borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none"},children:[W.jsx("option",{value:"feet",children:"ft"}),W.jsx("option",{value:"meters",children:"m"})]})]})]}),W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Height"}),W.jsx("input",{type:"number",value:r,onChange:e=>n(e.target.value),placeholder:"0"})]})]})]}),W.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Wall Thickness"}),W.jsxs("select",{value:a,onChange:e=>i(e.target.value),children:[W.jsx("option",{value:"4",children:"4 inches (Partition)"}),W.jsx("option",{value:"9",children:"9 inches (Main Wall)"}),W.jsx("option",{value:"13.5",children:"14 inches (Load Bearing)"})]})]}),W.jsxs("div",{className:"input-group",children:[W.jsxs("label",{children:["Deductions (Sq.","feet"===l?"ft":"m",")"]}),W.jsx("input",{type:"number",value:d,onChange:e=>c(e.target.value),placeholder:"Door/Window area"})]})]}),W.jsxs("details",{children:[W.jsx("summary",{style:{cursor:"pointer",color:"var(--primary-color)",fontSize:"0.9rem"},children:"Advanced Settings (Brick Size & Ratio)"}),W.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",border:"1px solid var(--border-color)",borderRadius:"8px"},children:[W.jsxs("div",{className:"input-group mb-md",children:[W.jsx("label",{children:"Mortar Ratio (Cement : Sand)"}),W.jsxs("div",{className:"flex gap-md",children:[W.jsxs("label",{className:"flex gap-sm",style:{fontWeight:"normal"},children:[W.jsx("input",{type:"radio",name:"ratio",checked:"1:4"===m,onChange:()=>h("1:4")})," 1 : 4 (Strong)"]}),W.jsxs("label",{className:"flex gap-sm",style:{fontWeight:"normal"},children:[W.jsx("input",{type:"radio",name:"ratio",checked:"1:6"===m,onChange:()=>h("1:6")})," 1 : 6 (Standard)"]})]})]}),W.jsx("label",{className:"mb-sm block",children:"Brick Size (mm)"}),W.jsxs("div",{className:"flex gap-sm",children:[W.jsx("div",{className:"input-group",children:W.jsx("input",{type:"number",value:x,onChange:e=>p(e.target.value),placeholder:"L"})}),W.jsx("div",{className:"input-group",children:W.jsx("input",{type:"number",value:u,onChange:e=>g(e.target.value),placeholder:"W"})}),W.jsx("div",{className:"input-group",children:W.jsx("input",{type:"number",value:y,onChange:e=>j(e.target.value),placeholder:"H"})})]})]})]}),W.jsxs("button",{onClick:()=>{let e=parseFloat(t),s=parseFloat(r),n=parseFloat(a),i=parseFloat(d);if(isNaN(e)||isNaN(s))return void alert("Please enter valid length and height");let o=("feet"===l?.3048*e:e)*("feet"===l?.3048*s:s)-("feet"===l?.092903*i:i);o<0&&(o=0);let c=o*(.0254*n),h=c/((parseFloat(x)+10)/1e3*((parseFloat(u)+10)/1e3)*((parseFloat(y)+10)/1e3)),p=1.33*(c-h*(parseFloat(x)/1e3*(parseFloat(u)/1e3)*(parseFloat(y)/1e3))),[g,j]=m.split(":").map(Number),f=g+j,b=g/f*p/.0347,v=j/f*p,w=35.3147*v;N({bricks:Math.ceil(h),cement:b.toFixed(1),sand_m3:v.toFixed(2),sand_cft:w.toFixed(1),wallVol:c.toFixed(2)})},className:"btn btn-primary",style:{marginTop:"1rem"},children:[W.jsx(je,{size:20})," Calculate Materials"]})]}),W.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[f&&W.jsxs("div",{style:{height:"300px",border:"1px solid var(--border-color)",borderRadius:"8px",overflow:"hidden",position:"relative",background:"#f5f5f5"},children:[W.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,padding:"4px 8px",background:"rgba(0,0,0,0.7)",color:"white",fontSize:"0.75rem",zIndex:10},children:"Reference Plan View"}),W.jsx("img",{src:f,alt:"Plan Reference",style:{width:"100%",height:"100%",objectFit:"contain"}})]}),w&&W.jsxs("div",{className:"card fade-in",style:{background:"#f0f9ff",border:"1px solid #bae6fd"},children:[W.jsx("h3",{className:"mb-md",style:{color:"#0369a1"},children:"Estimation Results"}),W.jsxs("div",{style:{display:"grid",gap:"1rem"},children:[W.jsxs("div",{className:"flex-between p-sm",style:{background:"white",borderRadius:"6px"},children:[W.jsx("span",{className:"text-secondary",children:"ðŸ§± Total Bricks"}),W.jsxs("strong",{style:{fontSize:"1.2rem",color:"var(--primary-color)"},children:[w.bricks," nos"]})]}),W.jsxs("div",{className:"flex-between p-sm",style:{background:"white",borderRadius:"6px"},children:[W.jsx("span",{className:"text-secondary",children:"ðŸ—ï¸ Cement (50kg bags)"}),W.jsxs("strong",{style:{fontSize:"1.2rem"},children:[w.cement," bags"]})]}),W.jsxs("div",{className:"flex-between p-sm",style:{background:"white",borderRadius:"6px"},children:[W.jsx("span",{className:"text-secondary",children:"ðŸ–ï¸ Sand Quantity"}),W.jsxs("div",{style:{textAlign:"right"},children:[W.jsxs("div",{style:{fontWeight:600},children:[w.sand_cft," cft"]}),W.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:[w.sand_m3," mÂ³"]})]})]})]}),W.jsx("p",{className:"text-muted mt-md",style:{fontSize:"0.8rem",fontStyle:"italic"},children:"* Includes standard % for wastage and frog filling."})]})]})]})]})})},Se=()=>{const[t,s]=e.useState("box"),[r,n]=e.useState("feet"),[a,i]=e.useState("M20"),[l,o]=e.useState(1),[d,c]=e.useState(1.5),[m,h]=e.useState(3),[x,p]=e.useState(""),[u,g]=e.useState(""),[y,j]=e.useState(""),[f,b]=e.useState(""),[v,w]=e.useState(null),N={M10:{c:1,s:3,a:6},M15:{c:1,s:2,a:4},M20:{c:1,s:1.5,a:3},M25:{c:1,s:1,a:2}};return e.useEffect(()=>{(()=>{let e=0,s=parseFloat(x)||0,n=parseFloat(u)||0,i=parseFloat(y)||0,o=parseFloat(f)||0;if("feet"===r&&(s*=.3048,n*=.3048,i*=.3048,o*=.3048),"cylinder"===t){const t=o/2;e=Math.PI*t*t*i}else e=s*n*i;if(0===e)return void w(null);const c=1.54*e;let h,p,g;if("Custom"===a)h=parseFloat(l)||0,p=parseFloat(d)||0,g=parseFloat(m)||0;else{const e=N[a];h=e.c,p=e.s,g=e.a}const j=h+p+g;if(0===j)return;const b=c*h/j*1440/50,v=c*p/j*35.3147,S=c*g/j*35.3147;w({wetVol:"feet"===r?35.3147*e:e,cementBags:Math.ceil(b),sand:v.toFixed(2),aggregate:S.toFixed(2)})})()},[t,r,a,x,u,y,f,l,d,m]),W.jsxs("div",{className:"card",style:{background:"linear-gradient(to right bottom, #ffffff, #f8f9fa)"},children:[W.jsx("div",{className:"flex-between mb-lg",children:W.jsxs("h3",{className:"flex",style:{alignItems:"center",gap:"0.5rem",margin:0},children:[W.jsx(fe,{size:24,style:{color:"var(--primary-color)"}}),"Concrete Calculator"]})}),W.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"2rem"},children:[W.jsxs("div",{children:[W.jsx("h4",{className:"mb-md text-secondary",children:"Structure Details"}),W.jsxs("div",{className:"flex gap-md mb-md",children:[W.jsxs("div",{style:{flex:1},children:[W.jsx("label",{className:"text-secondary",style:{fontSize:"0.8rem",fontWeight:600},children:"Shape"}),W.jsxs("select",{value:t,onChange:e=>s(e.target.value),style:{width:"100%",padding:"0.8rem",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[W.jsx("option",{value:"box",children:"Box / Column / Beam"}),W.jsx("option",{value:"slab",children:"Floor Slab"}),W.jsx("option",{value:"cylinder",children:"Round Column"})]})]}),W.jsxs("div",{style:{flex:1},children:[W.jsx("label",{className:"text-secondary",style:{fontSize:"0.8rem",fontWeight:600},children:"Unit"}),W.jsxs("select",{value:r,onChange:e=>n(e.target.value),style:{width:"100%",padding:"0.8rem",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[W.jsx("option",{value:"feet",children:"Feet (ft)"}),W.jsx("option",{value:"meters",children:"Meters (m)"})]})]})]}),W.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1.5rem"},children:"cylinder"===t?W.jsxs(W.Fragment,{children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Diameter"}),W.jsx("input",{type:"number",value:f,onChange:e=>b(e.target.value),placeholder:"0"})]}),W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Height / Depth"}),W.jsx("input",{type:"number",value:y,onChange:e=>j(e.target.value),placeholder:"0"})]})]}):W.jsxs(W.Fragment,{children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Length"}),W.jsx("input",{type:"number",value:x,onChange:e=>p(e.target.value),placeholder:"0"})]}),W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Width"}),W.jsx("input",{type:"number",value:u,onChange:e=>g(e.target.value),placeholder:"0"})]}),W.jsxs("div",{className:"input-group",style:{gridColumn:"span 2"},children:[W.jsx("label",{children:"slab"===t?"Thickness":"Height / Depth"}),W.jsx("input",{type:"number",value:y,onChange:e=>j(e.target.value),placeholder:"0"})]})]})}),W.jsx("h4",{className:"mb-md text-secondary",children:"Mix Design"}),W.jsxs("div",{className:"mb-lg",children:[W.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"1rem"},children:["M10","M15","M20","M25","Custom"].map(e=>W.jsx("button",{onClick:()=>i(e),className:"btn btn-small "+(a===e?"btn-primary":"btn-secondary"),style:{flex:1,minWidth:"60px"},children:e},e))}),"Custom"===a?W.jsxs("div",{className:"flex gap-sm items-center",style:{background:"#f1f5f9",padding:"10px",borderRadius:"8px"},children:[W.jsxs("div",{style:{flex:1},children:[W.jsx("label",{style:{fontSize:"0.75rem"},children:"Cement"}),W.jsx("input",{type:"number",value:l,onChange:e=>o(e.target.value)})]}),W.jsx("div",{style:{fontWeight:"bold"},children:":"}),W.jsxs("div",{style:{flex:1},children:[W.jsx("label",{style:{fontSize:"0.75rem"},children:"Sand"}),W.jsx("input",{type:"number",value:d,onChange:e=>c(e.target.value)})]}),W.jsx("div",{style:{fontWeight:"bold"},children:":"}),W.jsxs("div",{style:{flex:1},children:[W.jsx("label",{style:{fontSize:"0.75rem"},children:"Agg."}),W.jsx("input",{type:"number",value:m,onChange:e=>h(e.target.value)})]})]}):W.jsxs("div",{className:"text-secondary",style:{fontSize:"0.9rem",padding:"8px",background:"#f8fafc",borderRadius:"6px",textAlign:"center"},children:["Ratio (Cement : Sand : Aggregate) = ",W.jsxs("strong",{children:[N[a].c," : ",N[a].s," : ",N[a].a]})]})]})]}),W.jsxs("div",{style:{background:"#f0f9ff",padding:"1.5rem",borderRadius:"12px",border:"1px solid #bae6fd",display:"flex",flexDirection:"column",justifyContent:"center"},children:[W.jsx("h3",{className:"text-primary mb-lg text-center",children:"Estimated Materials"}),v?W.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[W.jsxs("div",{className:"flex-between",style:{borderBottom:"1px solid #e0f2fe",paddingBottom:"1rem"},children:[W.jsxs("div",{className:"flex gap-sm items-center",children:[W.jsx("div",{style:{background:"#fff",padding:"8px",borderRadius:"50%"},children:"ðŸ§±"}),W.jsx("span",{style:{fontWeight:600},children:"Cement Bags"})]}),W.jsxs("div",{style:{textAlign:"right"},children:[W.jsx("div",{className:"text-primary",style:{fontSize:"1.5rem",fontWeight:700},children:v.cementBags}),W.jsx("div",{className:"text-secondary",style:{fontSize:"0.8rem"},children:"bags (50kg)"})]})]}),W.jsxs("div",{className:"flex-between",style:{borderBottom:"1px solid #e0f2fe",paddingBottom:"1rem"},children:[W.jsxs("div",{className:"flex gap-sm items-center",children:[W.jsx("div",{style:{background:"#fff",padding:"8px",borderRadius:"50%"},children:"ðŸ–ï¸"}),W.jsx("span",{style:{fontWeight:600},children:"Sand"})]}),W.jsxs("div",{style:{textAlign:"right"},children:[W.jsx("div",{style:{fontSize:"1.25rem",fontWeight:700},children:v.sand}),W.jsx("div",{className:"text-secondary",style:{fontSize:"0.8rem"},children:"cubic feet"})]})]}),W.jsxs("div",{className:"flex-between",children:[W.jsxs("div",{className:"flex gap-sm items-center",children:[W.jsx("div",{style:{background:"#fff",padding:"8px",borderRadius:"50%"},children:"ðŸª¨"}),W.jsx("span",{style:{fontWeight:600},children:"Aggregate"})]}),W.jsxs("div",{style:{textAlign:"right"},children:[W.jsx("div",{style:{fontSize:"1.25rem",fontWeight:700},children:v.aggregate}),W.jsx("div",{className:"text-secondary",style:{fontSize:"0.8rem"},children:"cubic feet"})]})]}),W.jsx("div",{className:"text-muted text-center mt-lg",style:{fontSize:"0.75rem"},children:"*Calculations based on dry volume coefficient of 1.54"})]}):W.jsx("div",{className:"text-center text-muted",style:{padding:"2rem 0"},children:"Enter dimensions to see material estimates."})]})]})]})},Ce=()=>{const[t,s]=e.useState([]),[r,n]=e.useState({description:"",shape:"stirrup",dia:8,noOfBars:1,a:0,b:0,cover:40,length:0,hookLength:0,spacing:150,memberLength:0}),[a,i]=e.useState(!1),l=e=>e*e/162,o=()=>{let e=0;const{shape:t,dia:s,a:n,b:a,cover:i,length:l}=r,o=parseFloat(s)||0,d=parseFloat(i)||0;if("stirrup"===t){const t=(parseFloat(n)||0)-2*d,s=(parseFloat(a)||0)-2*d;t>0&&s>0&&(e=2*(t+s)+12*o)}else if("straight"===t)e=parseFloat(l)||0;else if("crank"===t){e=(parseFloat(l)||0)+.42*(parseFloat(n)||0)}return e/1e3},d=()=>t.reduce((e,t)=>e+parseFloat(t.totalWeight),0).toFixed(2);return W.jsxs("div",{className:"card fade-in",style:{maxWidth:"1200px",margin:"0 auto"},children:[W.jsxs("div",{className:"flex-between mb-lg",style:{borderBottom:"1px solid var(--border-color)",paddingBottom:"1rem"},children:[W.jsxs("div",{className:"flex gap-md items-center",children:[W.jsx(re,{size:28,style:{color:"var(--primary-color)"}}),W.jsxs("div",{children:[W.jsx("h2",{style:{margin:0},children:"Bar Bending Schedule"}),W.jsx("p",{className:"text-secondary",style:{margin:0,fontSize:"0.9rem"},children:"Automated BBS Calculator & Book"})]})]}),W.jsxs("div",{className:"text-right",children:[W.jsxs("div",{className:"badge badge-primary",style:{fontSize:"1rem",padding:"0.5rem 1rem"},children:["Total Steel: ",d()," kg"]}),W.jsx("button",{onClick:()=>i(!0),className:"btn btn-ghost btn-small mt-sm",style:{display:"block",width:"100%",textAlign:"right",fontSize:"0.8rem"},children:"â„¹ï¸ Symbol Legend"})]})]}),W.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(300px, 1fr) 2fr",gap:"2rem"},children:[W.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"1.5rem",borderRadius:"12px"},children:[W.jsx("h3",{className:"mb-md",children:"Add New Bar"}),W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Description (Location)"}),W.jsx("input",{type:"text",placeholder:"e.g. Beam B1 Bottom Bars",value:r.description,onChange:e=>n({...r,description:e.target.value})})]}),W.jsxs("div",{className:"flex gap-md mb-md",children:[W.jsxs("div",{style:{flex:1},children:[W.jsx("label",{style:{fontSize:"0.8rem",fontWeight:600},children:"Shape"}),W.jsxs("select",{value:r.shape,onChange:e=>n({...r,shape:e.target.value}),style:{width:"100%",padding:"0.6rem",borderRadius:"6px"},children:[W.jsx("option",{value:"stirrup",children:"â¬œ Stirrup (Rect)"}),W.jsx("option",{value:"straight",children:"âž– Straight Bar"}),W.jsx("option",{value:"crank",children:"ã€°ï¸ Crank / Bent-up"})]})]}),W.jsxs("div",{style:{flex:1},children:[W.jsx("label",{style:{fontSize:"0.8rem",fontWeight:600},children:"Diameter (mm)"}),W.jsx("select",{value:r.dia,onChange:e=>n({...r,dia:e.target.value}),style:{width:"100%",padding:"0.6rem",borderRadius:"6px"},children:[8,10,12,16,20,25,32].map(e=>W.jsxs("option",{value:e,children:[e," mm"]},e))})]})]}),W.jsxs("div",{className:"mb-md",children:["stirrup"===r.shape&&W.jsxs("div",{className:"grid-2-col gap-sm",children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Width (A) (mm)"}),W.jsx("input",{type:"number",value:r.a,onChange:e=>n({...r,a:e.target.value}),placeholder:"e.g. 300"})]}),W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Depth (B) (mm)"}),W.jsx("input",{type:"number",value:r.b,onChange:e=>n({...r,b:e.target.value}),placeholder:"e.g. 450"})]}),W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Cover (mm)"}),W.jsx("input",{type:"number",value:r.cover,onChange:e=>n({...r,cover:e.target.value})})]})]}),"straight"===r.shape&&W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Total Length (mm)"}),W.jsx("input",{type:"number",value:r.length,onChange:e=>n({...r,length:e.target.value}),placeholder:"e.g. 5000"})]}),"crank"===r.shape&&W.jsxs("div",{className:"grid-2-col gap-sm",children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Total Length (mm)"}),W.jsx("input",{type:"number",value:r.length,onChange:e=>n({...r,length:e.target.value}),placeholder:"e.g. 6000"})]}),W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Bend Height (mm)"}),W.jsx("input",{type:"number",value:r.a,onChange:e=>n({...r,a:e.target.value}),placeholder:"Slab depth usually"})]})]})]}),W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"No. of Bars"}),W.jsxs("div",{className:"flex gap-sm",children:[W.jsx("input",{type:"number",value:r.noOfBars,onChange:e=>n({...r,noOfBars:e.target.value}),style:{flex:1}}),"stirrup"===r.shape&&W.jsx("div",{className:"text-muted text-small flex-center",style:{width:"100px",lineHeight:1},children:"(Enter total rings)"})]})]}),W.jsx("button",{className:"btn btn-primary w-100",onClick:()=>{const e=o();if(e<=0)return alert("Please check dimensions");const a=l(r.dia),i=e*r.noOfBars,d=i*a,c={id:Date.now(),...r,cutLength:e.toFixed(3),totalLength:i.toFixed(2),totalWeight:d.toFixed(2)};s([...t,c]),n({...r,description:"",a:0,b:0,length:0})},children:"Add to Schedule"}),W.jsxs("div",{className:"mt-md p-sm bg-white rounded text-center text-secondary",style:{fontSize:"0.85rem"},children:["Cut Length: ",W.jsxs("strong",{children:[o().toFixed(3)," m"]})," ",W.jsx("br",{}),"Unit Weight: ",W.jsxs("strong",{children:[l(r.dia).toFixed(3)," kg/m"]})]})]}),W.jsx("div",{style:{overflowX:"auto"},children:W.jsxs("table",{className:"w-100",style:{borderCollapse:"collapse",fontSize:"0.9rem"},children:[W.jsx("thead",{children:W.jsxs("tr",{style:{background:"#f8f9fa",borderBottom:"2px solid #e9ecef"},children:[W.jsx("th",{style:{padding:"10px",textAlign:"left"},children:"#"}),W.jsx("th",{style:{padding:"10px",textAlign:"left"},children:"Description"}),W.jsx("th",{style:{padding:"10px"},children:"Shape"}),W.jsx("th",{style:{padding:"10px"},children:"Dia"}),W.jsx("th",{style:{padding:"10px"},children:"No."}),W.jsx("th",{style:{padding:"10px"},children:"Cut Len (m)"}),W.jsx("th",{style:{padding:"10px"},children:"Total Wt (kg)"}),W.jsx("th",{style:{padding:"10px"}})]})}),W.jsx("tbody",{children:0===t.length?W.jsx("tr",{children:W.jsx("td",{colSpan:"8",className:"text-center text-muted",style:{padding:"2rem"},children:"No items in schedule yet. Add a bar to start."})}):t.map((e,r)=>W.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[W.jsx("td",{style:{padding:"10px"},children:r+1}),W.jsx("td",{style:{padding:"10px"},children:e.description}),W.jsxs("td",{style:{padding:"10px",textAlign:"center"},children:["stirrup"===e.shape&&"â¬œ","straight"===e.shape&&"âž–","crank"===e.shape&&"ã€°ï¸"]}),W.jsx("td",{style:{padding:"10px",textAlign:"center"},children:e.dia}),W.jsx("td",{style:{padding:"10px",textAlign:"center"},children:e.noOfBars}),W.jsx("td",{style:{padding:"10px",textAlign:"center"},children:e.cutLength}),W.jsx("td",{style:{padding:"10px",textAlign:"center",fontWeight:"bold"},children:e.totalWeight}),W.jsx("td",{style:{padding:"10px"},children:W.jsx("button",{onClick:()=>{return r=e.id,void s(t.filter(e=>e.id!==r));var r},className:"btn-ghost text-danger",style:{padding:"4px"},children:W.jsx(X,{size:16})})})]},e.id))}),t.length>0&&W.jsx("tfoot",{children:W.jsxs("tr",{style:{background:"#f8f9fa",fontWeight:"bold"},children:[W.jsx("td",{colSpan:"6",style:{padding:"10px",textAlign:"right"},children:"Total Project Steel:"}),W.jsxs("td",{style:{padding:"10px",textAlign:"center",color:"var(--primary-color)"},children:[d()," kg"]}),W.jsx("td",{})]})})]})})]}),a&&W.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",justifyContent:"center",alignItems:"center"},children:W.jsxs("div",{className:"card fade-in",style:{width:"90%",maxWidth:"600px",maxHeight:"80vh",overflowY:"auto"},children:[W.jsxs("div",{className:"flex-between mb-md",children:[W.jsx("h3",{children:"Structural Symbols Legend"}),W.jsx("button",{onClick:()=>i(!1),className:"btn btn-ghost",children:"âœ•"})]}),W.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"X"}),W.jsx("span",{children:"Void / Opening / Column Position"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"----"}),W.jsx("span",{children:"Hidden Line / Beam Below"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"âŒ–"}),W.jsx("span",{children:"Level Marker / Elevation"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"#"}),W.jsx("span",{children:"Deformed Bar (TMT)"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"@"}),W.jsx("span",{children:"Center to Center Spacing (c/c)"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"Ã˜"}),W.jsx("span",{children:"Diameter (Dia)"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"CL"}),W.jsx("span",{children:"Center Line"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"FFL"}),W.jsx("span",{children:"Finished Floor Level"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"BM"}),W.jsx("span",{children:"Beam"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"COL"}),W.jsx("span",{children:"Column"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"SL"}),W.jsx("span",{children:"Slab"})]}),W.jsxs("div",{className:"p-sm bg-light rounded flex gap-sm items-center",children:[W.jsx("strong",{style:{fontSize:"1.2rem"},children:"RCC"}),W.jsx("span",{children:"Reinforced Concrete"})]})]}),W.jsxs("div",{className:"mt-lg",children:[W.jsx("h4",{children:"Standard Bends"}),W.jsxs("p",{className:"text-small text-secondary",children:["â€¢ 45Â° Bend: 1d deduction",W.jsx("br",{}),"â€¢ 90Â° Bend: 2d deduction",W.jsx("br",{}),"â€¢ 135Â° Hook: 3d deduction + 10d length",W.jsx("br",{}),"â€¢ 180Â° Hook: 4d deduction"]})]}),W.jsx("button",{onClick:()=>i(!1),className:"btn btn-primary w-100 mt-lg",children:"Close"})]})})]})},ke=s.memo(({onSelectSite:t})=>{const{user:r,logout:n,isCEO:a,upgradeToCEO:i}=q(),[l,d]=e.useState([]),[c,m]=e.useState("projects"),[h,x]=e.useState(!1),[p,N]=e.useState(""),[S,C]=e.useState(""),[k,z]=e.useState(!0),[B,F]=e.useState(null),[E,R]=e.useState(!1),[M,D]=e.useState(!1),[I,L]=e.useState(null),[T,O]=e.useState(""),[P,A]=e.useState(""),_=s.useRef(null);e.useEffect(()=>{R(a())},[r?.role,a]),e.useEffect(()=>{try{_.current=new BroadcastChannel("site_updates"),_.current.onmessage=e=>{"site_added"===e.data.type||"sites_updated"===e.data.type||e.data.type}}catch(e){}return()=>{_.current&&_.current.close()}},[]),e.useEffect(()=>{const e=u(j(U,"sites"),y("createdAt","desc"),g(100)),t=f(e,e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));d(t),z(!1),F(null),_.current&&_.current.postMessage({type:"sites_updated",count:t.length,timestamp:(new Date).toISOString()})},e=>{F("Failed to load sites. Check your internet connection or Firebase permissions."),z(!1)});return()=>t()},[]);return W.jsxs("div",{className:"container fade-in",style:{paddingTop:"3rem",paddingBottom:"3rem"},children:[W.jsxs("header",{className:"flex-between mb-lg",style:{alignItems:"flex-end",borderBottom:"1px solid var(--border-color)",paddingBottom:"1.5rem"},children:[W.jsxs("div",{children:[W.jsxs("div",{className:"flex gap-sm mb-sm",style:{alignItems:"center"},children:[W.jsx("div",{style:{color:"var(--accent-color)"},children:W.jsx(J,{size:28})}),W.jsx("h1",{style:{margin:0},children:"Project Dashboard"})]}),W.jsxs("p",{className:"text-secondary",style:{fontSize:"0.9375rem"},children:["Managing ",W.jsx("strong",{className:"text-main",children:l.length})," active construction sites"]})]}),W.jsxs("div",{className:"flex gap-md",style:{alignItems:"center"},children:[W.jsxs("div",{className:"text-right mr-md",style:{textAlign:"right",marginRight:"1rem"},children:[W.jsx("div",{style:{fontSize:"0.875rem",fontWeight:600},children:r.name}),W.jsx("div",{className:"badge badge-primary",children:r.role})]}),W.jsxs("button",{onClick:async()=>{try{await n()}catch(e){alert("Error signing out. Please try again.")}},className:"btn btn-secondary",style:{padding:"0.5rem 1rem"},children:[W.jsx(te,{size:18})," Sign Out"]})]})]}),W.jsxs("div",{className:"mb-lg",style:{background:"var(--bg-secondary)",padding:"4px",borderRadius:"12px",display:"inline-flex",gap:"4px",flexWrap:"wrap"},children:[W.jsxs("button",{onClick:()=>m("projects"),className:"btn btn-small "+("projects"===c?"btn-primary":"btn-ghost"),style:{borderRadius:"8px"},children:[W.jsx(Y,{size:16,style:{marginRight:"6px"}}),"All Projects"]}),W.jsxs("button",{onClick:()=>m("converter"),className:"btn btn-small "+("converter"===c?"btn-primary":"btn-ghost"),style:{borderRadius:"8px"},children:[W.jsx(re,{size:16,style:{marginRight:"6px",transform:"rotate(45deg)"}}),"Measurement Converter"]}),W.jsxs("button",{onClick:()=>m("area"),className:"btn btn-small "+("area"===c?"btn-primary":"btn-ghost"),style:{borderRadius:"8px"},children:[W.jsx(G,{size:16,style:{marginRight:"6px"}}),"Area Calculator"]}),W.jsxs("button",{onClick:()=>m("brick"),className:"btn btn-small "+("brick"===c?"btn-primary":"btn-ghost"),style:{borderRadius:"8px"},children:[W.jsx(je,{size:16,style:{marginRight:"6px"}}),"Brick Calculator"]}),W.jsxs("button",{onClick:()=>m("concrete"),className:"btn btn-small "+("concrete"===c?"btn-primary":"btn-ghost"),style:{borderRadius:"8px"},children:[W.jsx(fe,{size:16,style:{marginRight:"6px"}}),"Concrete Calculator"]}),W.jsxs("button",{onClick:()=>m("bbs"),className:"btn btn-small "+("bbs"===c?"btn-primary":"btn-ghost"),style:{borderRadius:"8px"},children:[W.jsx(re,{size:16,style:{marginRight:"6px"}}),"Bar Bending (BBS)"]})]}),"projects"===c&&W.jsxs("div",{className:"fade-in",children:[W.jsxs("div",{className:"flex-between mb-lg",children:[W.jsx("div",{className:"flex gap-md",style:{flex:1,maxWidth:"600px"},children:W.jsxs("div",{style:{position:"relative",flex:1},children:[W.jsx("div",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-muted)"},children:W.jsx(Q,{size:18})}),W.jsx("input",{type:"text",placeholder:"Search projects by name or location...",style:{paddingLeft:"40px"}})]})}),E&&W.jsxs("button",{onClick:()=>x(!0),className:"btn btn-primary",children:[W.jsx(K,{size:18})," Create New Project"]}),!E&&W.jsx("button",{onClick:async()=>{const e=prompt("Enter CEO Secret Code:");if(e){D(!0);try{await i(e)?alert("Successfully upgraded to CEO role."):alert("Invalid code.")}catch(t){alert("An error occurred during upgrade.")}D(!1)}},disabled:M,className:"btn btn-secondary",children:M?"Verifying...":"Upgrade to CEO"})]}),k?W.jsxs("div",{className:"flex-center",style:{minHeight:"40vh",flexDirection:"column",gap:"1rem"},children:[W.jsx("div",{className:"loading-spinner"}),W.jsx("p",{className:"text-secondary",children:"Synchronizing project data..."})]}):W.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(340px, 1fr))",gap:"1.5rem"},children:l.map((e,s)=>W.jsxs("div",{className:"card fade-in",onClick:()=>{t(e)},style:{cursor:"pointer",animationDelay:.05*s+"s",display:"flex",flexDirection:"column",justifyContent:"space-between",minHeight:"180px",position:"relative",userSelect:"none",outline:"none",border:"1px solid var(--border-color)",background:"var(--card-bg, #fff)",padding:"1.5rem",font:"inherit",textAlign:"left",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.04)"},tabIndex:0,role:"button",children:[E&&e.createdBy===r.uid&&W.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px",display:"flex",gap:"6px"},children:[W.jsx("button",{onClick:t=>{t.stopPropagation(),t.preventDefault(),L(e.id),O(e.name),A(e.location)},style:{background:"var(--primary-color)",color:"white",border:"none",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"0.75rem",fontWeight:600},children:"Edit"}),W.jsx("button",{onClick:t=>{t.stopPropagation(),t.preventDefault(),confirm(`Delete "${e.name}"?`)&&(async(e,t)=>{try{await b(o(U,"sites",e)),_.current&&_.current.postMessage({type:"site_deleted",siteId:e,siteName:t,timestamp:(new Date).toISOString()}),alert(`âœ… "${t}" has been deleted.`)}catch(s){alert("âŒ Failed to delete site:\n"+s.message)}})(e.id,e.name)},style:{background:"var(--danger-color)",color:"white",border:"none",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"0.75rem",fontWeight:600},children:"Delete"})]}),W.jsxs("div",{children:[W.jsxs("div",{className:"flex-between mb-sm",children:[W.jsx("div",{className:"badge badge-primary",children:"Active Project"}),W.jsxs("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:["ID: ",e.id.substring(0,8)]})]}),I===e.id?W.jsxs("div",{onClick:e=>e.stopPropagation(),style:{padding:"0.5rem 0"},children:[W.jsx("input",{type:"text",value:T,onChange:e=>O(e.target.value),placeholder:"Site name",style:{marginBottom:"0.5rem",width:"100%"},autoFocus:!0}),W.jsx("input",{type:"text",value:P,onChange:e=>A(e.target.value),placeholder:"Location",style:{marginBottom:"0.5rem",width:"100%"}}),W.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[W.jsx("button",{onClick:()=>(async e=>{if(T.trim())try{await v(o(U,"sites",e),{name:T.trim(),location:P.trim()||"Not specified"}),L(null),alert("âœ… Site updated successfully!")}catch(t){alert("âŒ Failed to update site:\n"+t.message)}else alert("âŒ Site name cannot be empty")})(e.id),className:"btn btn-primary btn-small",style:{flex:1},children:"Save"}),W.jsx("button",{onClick:()=>L(null),className:"btn btn-secondary btn-small",style:{flex:1},children:"Cancel"})]})]}):W.jsxs(W.Fragment,{children:[W.jsx("h3",{className:"mb-sm",style:{color:"var(--primary-color)"},children:e.name}),W.jsxs("p",{className:"text-secondary",style:{fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"4px"},children:[W.jsx(de,{size:14})," ",e.location]})]})]}),W.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid var(--border-color)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[W.jsx("span",{className:"text-primary",style:{fontSize:"0.875rem",fontWeight:600},children:E?"âœï¸ Edit & Manage â†’":"ðŸ“Š View & Contribute â†’"}),W.jsxs("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:["Created: ",new Date(e.createdAt).toLocaleDateString()]})]})]},e.id))}),!k&&0===l.length&&W.jsxs("div",{className:"flex-center",style:{minHeight:"40vh",flexDirection:"column",textAlign:"center"},children:[W.jsx("div",{style:{marginBottom:"1.5rem",maxWidth:"300px"},children:W.jsx("img",{src:"/BR-Construction/assets/construction_empty_state-CNx-_DIq.png",alt:"No Projects",style:{width:"100%",opacity:.9}})}),W.jsx("h3",{className:"text-secondary",style:{marginTop:"-1rem",position:"relative",zIndex:1},children:"No Projects Found"}),W.jsx("p",{className:"text-muted mb-md",children:"Get started by creating your first construction project."}),E&&W.jsxs("button",{onClick:()=>x(!0),className:"btn btn-primary",children:[W.jsx(K,{size:18})," Create Project"]})]})]}),"converter"===c&&W.jsx("div",{className:"fade-in",children:W.jsx(ve,{})}),"area"===c&&W.jsx("div",{className:"fade-in",children:W.jsx(we,{})}),"brick"===c&&W.jsx("div",{className:"fade-in",children:W.jsx(Ne,{})}),"concrete"===c&&W.jsx("div",{className:"fade-in",children:W.jsx(Se,{})}),"bbs"===c&&W.jsx("div",{className:"fade-in",children:W.jsx(Ce,{})}),h&&W.jsxs("div",{className:"card mb-lg fade-in",style:{maxWidth:"600px",margin:"0 auto 2rem"},children:[W.jsxs("div",{className:"flex-between mb-md",children:[W.jsx("h3",{children:"New Project Details"}),W.jsx("button",{onClick:()=>x(!1),className:"btn btn-secondary",style:{padding:"4px 8px"},children:"âœ•"})]}),W.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),p.trim())if(r)if(E)try{const e={name:p.trim(),location:S.trim()||"Not specified",createdAt:(new Date).toISOString(),createdBy:r.uid,createdByEmail:r.email,expenseColumns:[{id:"item",name:"Item Description",type:"text",width:"200px"},{id:"date",name:"Date",type:"text",width:"120px"},{id:"amount",name:"Amount (â‚¹)",type:"number",width:"120px"},{id:"dailyTotal",name:"Daily Total",type:"number",width:"120px"}],ceoBudget:"",ceoProjectValue:""},t=await w(j(U,"sites"),e);_.current&&_.current.postMessage({type:"site_added",siteId:t.id,siteName:p,timestamp:(new Date).toISOString()}),N(""),C(""),x(!1),alert("âœ… Site added successfully!")}catch(t){alert("âŒ Failed to add site:\n"+t.message+"\n\nCheck console for details.")}else alert("âŒ Only CEO users can add sites. Your role: "+r.role);else alert("âŒ You must be logged in to add sites");else alert("âŒ Please enter a site name")},children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Project Name"}),W.jsx("input",{type:"text",placeholder:"e.g., Sky Tower Phase 1",value:p,onChange:e=>N(e.target.value),required:!0})]}),W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Location"}),W.jsx("input",{type:"text",placeholder:"e.g., North District, Block C",value:S,onChange:e=>C(e.target.value)})]}),W.jsxs("div",{className:"flex gap-sm",style:{justifyContent:"flex-end"},children:[W.jsx("button",{type:"button",onClick:()=>x(!1),className:"btn btn-secondary",children:"Cancel"}),W.jsx("button",{type:"submit",className:"btn btn-primary",children:"Initialize Project"})]})]})]}),B&&W.jsx("div",{className:"card mb-lg",style:{borderLeft:"4px solid var(--danger-color)"},children:W.jsxs("div",{className:"flex gap-md",children:[W.jsx("div",{className:"text-danger",children:W.jsx(le,{size:24})}),W.jsxs("div",{children:[W.jsx("h4",{className:"text-danger",children:"System Error"}),W.jsx("p",{className:"text-secondary",children:B})]})]})})]})}),ze=(e,{maxWidth:t=1920,maxHeight:s=1920,quality:r=.7}={})=>new Promise((n,a)=>{if(!e.type.startsWith("image/"))return n(e);const i=new FileReader;i.readAsDataURL(e),i.onload=i=>{const l=new Image;l.src=i.target.result,l.onload=()=>{const i=document.createElement("canvas");let o=l.width,d=l.height;o>d?o>t&&(d=Math.round(d*t/o),o=t):d>s&&(o=Math.round(o*s/d),d=s),i.width=o,i.height=d;i.getContext("2d").drawImage(l,0,0,o,d),i.toBlob(t=>{if(!t)return void a(new Error("Canvas toBlob failed"));const s=new File([t],e.name,{type:"image/jpeg",lastModified:Date.now()});n(s)},"image/jpeg",r)},l.onerror=e=>a(e)},i.onerror=e=>a(e)}),Be=s.memo(({rowId:t,colId:r,value:n,type:a,onUpdate:i,isReadOnly:l})=>{const[o,d]=e.useState(n),c=s.useRef(null);e.useEffect(()=>{d(n)},[n]);return W.jsx("input",{type:"number"===a?"number":"text",value:o||"",onChange:e=>{if(l)return void e.preventDefault();const s=e.target.value;d(s),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{i(t,r,s)},800)},onBlur:()=>{l||c.current&&(clearTimeout(c.current),i(t,r,o))},onKeyDown:e=>{l&&e.preventDefault()},disabled:l,readOnly:l,title:l?"ðŸ”’ CEO-managed field (Read-only)":"",style:{width:"100%",minWidth:"date"===r?"135px":"auto",background:l?"rgba(100, 116, 139, 0.08)":"transparent",border:"none",padding:"4px 8px",cursor:l?"not-allowed":"text",opacity:l?.6:1,fontSize:"0.9375rem",color:l?"var(--text-muted)":"var(--text-main)",fontWeight:l?600:400,boxSizing:"border-box"}})}),Fe=s.memo(({row:e,columns:t,onUpdate:r,onDelete:n,onUpload:a,isUploading:i,isCEOUser:l,dailyTotalCell:o})=>{const d=!l&&"CEO"===e.createdByRole,c=l||!d,m=s.useRef(null);return W.jsxs("tr",{style:{background:l?"transparent":"rgba(100, 200, 255, 0.02)"},children:[t.filter(e=>"dailyTotal"!==e.id).map(t=>{const s=e.cellCreators?.[t.id],n=!l&&("CEO"===t.createdByRole||"CEO"===s);return W.jsx("td",{children:W.jsx(Be,{rowId:e.id,colId:t.id,value:e[t.id],type:t.type,onUpdate:r,isReadOnly:n})},`${e.id}-${t.id}`)}),o,W.jsx("td",{children:e.receiptUrl?W.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[W.jsx("a",{href:e.receiptUrl,target:"_blank",rel:"noopener noreferrer",style:{display:"block"},children:(e=>{if(!e)return!1;const t=e.toLowerCase();return t.includes(".jpg")||t.includes(".jpeg")||t.includes(".png")||t.includes(".gif")||t.includes(".webp")||t.includes("alt=media")})(e.receiptUrl)?W.jsx("img",{src:e.receiptUrl,alt:"Receipt",style:{width:"32px",height:"32px",objectFit:"cover",borderRadius:"4px",border:"1px solid var(--glass-border)",cursor:"zoom-in"},onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/32?text=ðŸ“„"}}):W.jsx("div",{style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-secondary)",borderRadius:"4px",fontSize:"1.2rem"},children:"ðŸ“„"})}),W.jsx("a",{href:e.receiptUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary",style:{fontSize:"0.75rem",fontWeight:"bold"},children:"View"})]}):W.jsxs("label",{style:{cursor:c&&!i?"pointer":"not-allowed",fontSize:"0.8rem",color:c?"var(--text-secondary)":"var(--text-muted)",opacity:c?1:.5,display:"flex",alignItems:"center",gap:"4px"},onClick:()=>{c&&!i&&m.current&&m.current.click()},children:[i?W.jsx("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:W.jsx("span",{className:"loading-spinner-small"})}):W.jsxs(W.Fragment,{children:[W.jsx(ee,{})," ",W.jsx("span",{style:{marginLeft:"4px"},children:"Upload"})]}),c&&W.jsx("input",{ref:m,type:"file",style:{display:"none"},accept:"image/*,application/pdf",onChange:t=>{t.target.files&&t.target.files[0]&&(a(e.id,t.target.files[0]),t.target.value="")},disabled:i})]})}),W.jsx("td",{children:l?W.jsx("button",{onClick:()=>n(e.id),className:"btn btn-danger btn-small",title:"Delete Row",children:W.jsx(X,{})}):W.jsx("button",{onClick:()=>n(e.id),className:"btn btn-danger btn-small",title:"Delete Your Expense Row",children:W.jsx(X,{})})})]})}),Ee=s.memo(({site:t,onBack:r,user:n,isCEO:a,hideHeader:i=!1})=>{const[l,d]=e.useState([]),[c,m]=e.useState([]),[h,x]=e.useState(!0),[p,z]=e.useState(""),[B,F]=e.useState(""),[E,R]=e.useState(""),[M,D]=e.useState(!1),[I,L]=e.useState(!1),[T,O]=e.useState(!1),[P,A]=e.useState(""),[_,H]=e.useState({}),q=a(),$=s.useRef(null);e.useEffect(()=>{try{$.current=new BroadcastChannel(`expenses_${t.id}`),$.current.onmessage=e=>{}}catch(e){}return()=>{$.current&&$.current.close()}},[t.id]),e.useEffect(()=>{const e=f(o(U,"sites",t.id),e=>{if(e.exists()){const t=e.data(),s=t.expenses||{},r=[{id:"item",name:"Item Description",type:"text",width:"200px",createdByRole:"SYSTEM"},{id:"date",name:"Date",type:"text",width:"120px",createdByRole:"SYSTEM"},{id:"amount",name:"Amount (â‚¹)",type:"number",width:"120px",createdByRole:"SYSTEM"},{id:"dailyTotal",name:"Daily Total",type:"number",width:"120px",createdByRole:"SYSTEM"}],n=(t.expenseColumns||s.columns||r).map(e=>({...e,createdByRole:e.createdByRole||"SYSTEM"}));m(n),z(t.ceoBudget||s.ceoBudget||""),F(t.ceoProjectValue||s.ceoProjectValue||"")}});return()=>e()},[t.id]),e.useEffect(()=>{const e=u(j(U,"sites",t.id,"expenses"),y("createdAt","desc"),g(500)),s=f(e,e=>{const t=e.docs.map(e=>{const t=e.data();return t.cellCreators||(t.cellCreators={},t.createdByRole&&Object.keys(t).forEach(e=>{"id"!==e&&"createdAt"!==e&&"updatedAt"!==e&&"createdByRole"!==e&&"lastUpdatedByRole"!==e&&"cellCreators"!==e&&t[e]&&(t.cellCreators[e]=t.createdByRole)})),{id:e.id,...t}});d(t),x(!1)},e=>{x(!1),alert("âš ï¸ Failed to load expenses. Please check your connection.")});return()=>s()},[t.id]);const Y=e.useCallback(async(e,s)=>{try{await w(j(U,"audit_logs"),{action:e,details:s,siteId:t.id,siteName:t.name,userId:n.uid,userEmail:n.email,timestamp:N()})}catch(r){}},[t.id,t.name,n.uid,n.email]),J=e.useCallback(async(e,s,r)=>{L(!0);const n=o(U,"sites",t.id);try{await v(n,{expenseColumns:e,ceoBudget:s,ceoProjectValue:r}),Y("UPDATE_METADATA",{budget:s,projectValue:r})}catch(a){alert("Failed to save changes.")}L(!1)},[t.id,Y]),ee=e.useCallback(async(e,s,r)=>{const a=l.find(t=>t.id===e),i=a?.cellCreators?.[s];if(!q&&"CEO"===i)return;if("amount"===s&&r&&isNaN(parseFloat(r)))return void alert("âŒ Amount must be a valid number");const c=q?"CEO":n.role;d(t=>t.map(t=>t.id===e?{...t,[s]:r,lastUpdatedByRole:n.role,cellCreators:{...t.cellCreators,[s]:c}}:t));try{if(await v(o(U,"sites",t.id,"expenses",e),{[s]:r,lastUpdatedByRole:n.role,cellCreators:{...a?.cellCreators||{},[s]:c},updatedAt:N()}),$.current)try{$.current.postMessage({type:"cell_updated",rowId:e,colId:s,value:r,updatedBy:n.email,timestamp:(new Date).toISOString()})}catch(m){}}catch(h){alert("âŒ Failed to save "+s+". Please try again."),d(t=>t.map(t=>t.id===e?{...t,[s]:a[s]}:t))}},[t.id,n.role,q,l]),te=e.useCallback(async e=>{if(!e)return;const s=l.find(t=>t.id===e);if(q||"CEO"!==s?.createdByRole){if(window.confirm("Delete this expense row?"))try{await b(o(U,"sites",t.id,"expenses",e)),Y("DELETE_EXPENSE",{expenseId:e})}catch(r){alert("Failed to delete row: "+r.message)}}else alert("âŒ You can only delete rows you created. CEO-created rows cannot be deleted by members.")},[t.id,Y,q,l]),re=e.useCallback(async(e,s)=>{if(!s)return;if(!V)return void alert("âŒ Storage not configured. Please check your Firebase settings.");if(["image/jpeg","image/png","image/gif","image/webp","application/pdf"].includes(s.type))if(s.size>10485760)alert("âŒ File size exceeds 10MB limit");else{H(t=>({...t,[e]:!0}));try{let r=s;s.type.startsWith("image/")&&(r=await ze(s,{maxWidth:1280,maxHeight:1280,quality:.6}));const n=r.name.split(".").pop(),a=`${Date.now()}_${Math.random().toString(36).substring(7)}.${n}`,i=S(V,`receipts/${t.id}/${e}/${a}`);await C(i,r);const l=await k(i),c={receiptUrl:l,receiptName:r.name,receiptSize:r.size,receiptType:r.type,uploadedAt:N(),updatedAt:N()};await v(o(U,"sites",t.id,"expenses",e),c),d(t=>t.map(t=>t.id===e?{...t,receiptUrl:l,receiptName:s.name,receiptSize:s.size,receiptType:s.type}:t)),Y("UPLOAD_RECEIPT",{expenseId:e,fileName:s.name,fileSize:s.size}),alert("âœ… Receipt uploaded successfully!")}catch(r){r.message.includes("retry-limit-exceeded")||"storage/not-initialized"===r.code?alert("âš ï¸ Storage Connection Failed!\n\nThis usually means:\n1. Storage is NOT enabled in Firebase Console (Most Likely).\n2. Storage Rules are blocking the upload.\n\nPlease go to Firebase Console > Storage and click 'Get Started'."):"storage/unauthorized"===r.code?alert("âŒ Permission denied. Make sure Firebase Storage Rules allow uploads."):alert("âŒ Upload failed: "+r.message)}finally{H(t=>({...t,[e]:!1}))}}else alert("âŒ Only images (JPG, PNG, GIF, WebP) and PDF files are allowed")},[t.id,Y]),ae=()=>{if(0===l.length)return void alert("No data to export");const e=[c.map(e=>e.name).join(","),...l.map(e=>c.map(t=>{const s=e[t.id]||"";return`"${String(s).replace(/"/g,'""')}"`}).join(","))].join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=`${t.name}_expenses_${(new Date).toISOString().split("T")[0]}.csv`,r.click(),Y("EXPORT_CSV",{})},ie=e.useMemo(()=>{if(!P)return l;const e=P.toLowerCase();return l.filter(t=>Object.values(t).some(t=>t&&String(t).toLowerCase().includes(e)))},[l,P]),le=e.useMemo(()=>{const e={};return ie.forEach(t=>{const s=t.date||"No Date";e[s]||(e[s]=[]),e[s].push(t)}),Object.keys(e).sort((e,t)=>{if("No Date"===e)return 1;if("No Date"===t)return-1;const[s,r,n]=e.split("/").map(Number),[a,i,l]=t.split("/").map(Number);return new Date(l,i-1,a)-new Date(n,r-1,s)}).map(t=>{const s=e[t].reduce((e,t)=>e+(parseFloat(t.amount)||0),0);return{date:t,rows:e[t].map(e=>({...e,dailyTotal:s})),subtotal:s}})},[ie]),me=e.useMemo(()=>ie.reduce((e,t)=>e+(parseFloat(t.amount)||0),0),[ie]),he=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),xe=parseFloat(p)||0,pe=e.useMemo(()=>xe>0?me/xe*100:0,[me,xe]),ue=xe-me;return W.jsxs("div",{className:"container fade-in",style:{paddingTop:"2rem",paddingBottom:"4rem"},children:[!i&&W.jsxs("header",{className:"flex-between mb-lg",style:{alignItems:"center",borderBottom:"1px solid var(--border-color)",paddingBottom:"1.5rem"},children:[W.jsxs("div",{className:"flex gap-md",style:{alignItems:"center"},children:[W.jsx("button",{onClick:r,className:"btn btn-secondary",style:{padding:"8px"},children:W.jsx(oe,{size:20})}),W.jsxs("div",{children:[W.jsxs("div",{className:"flex gap-sm",style:{alignItems:"center"},children:[W.jsx("div",{style:{color:"var(--accent-color)"},children:W.jsx(G,{size:24})}),W.jsx("h2",{style:{margin:0},children:t.name})]}),W.jsxs("p",{className:"text-secondary",style:{fontSize:"0.875rem",marginTop:"2px"},children:[W.jsx(de,{size:14})," ",t.location]})]})]}),W.jsx("div",{className:"flex gap-sm",children:W.jsxs("button",{onClick:ae,className:"btn btn-secondary",children:[W.jsx(Z,{size:18})," Export Data"]})})]}),i&&W.jsx("div",{className:"flex justify-end mb-md",children:W.jsxs("button",{onClick:ae,className:"btn btn-secondary btn-small",children:[W.jsx(Z,{size:16})," Export CSV"]})}),W.jsxs("section",{className:"card mb-lg",style:{background:"var(--primary-color)",color:"white",border:"none"},children:[W.jsxs("div",{className:"flex-between mb-md",children:[W.jsxs("h3",{style:{color:"white",margin:0,display:"flex",alignItems:"center",gap:"8px"},children:[W.jsx(se,{size:20})," Project Financials"]}),q&&W.jsxs("div",{className:"flex gap-sm align-center",children:[T&&W.jsx("span",{className:"fade-in",style:{fontSize:"0.75rem",color:"var(--success-color)",fontWeight:600},children:"Changes Saved"}),W.jsx("button",{onClick:()=>{J(c,p,B),O(!0),setTimeout(()=>O(!1),3e3)},className:"btn btn-success",style:{padding:"6px 12px",fontSize:"0.75rem"},children:"Update Budget"})]})]}),W.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"2rem"},children:[W.jsxs("div",{className:"input-group",style:{marginBottom:0},children:[W.jsx("label",{style:{color:"rgba(255,255,255,0.7)"},children:"Total Project Value"}),q?W.jsx("input",{type:"number",value:B,onChange:e=>F(e.target.value),style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white"},placeholder:"Enter value..."}):W.jsx("div",{style:{fontSize:"1.25rem",fontWeight:700},children:he(B)})]}),W.jsxs("div",{className:"input-group",style:{marginBottom:0},children:[W.jsx("label",{style:{color:"rgba(255,255,255,0.7)"},children:"Project Budget"}),q?W.jsx("input",{type:"number",value:p,onChange:e=>z(e.target.value),style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white"},placeholder:"Enter budget..."}):W.jsx("div",{style:{fontSize:"1.25rem",fontWeight:700},children:he(p)})]}),W.jsxs("div",{children:[W.jsx("label",{style:{color:"rgba(255,255,255,0.7)",fontSize:"0.875rem",fontWeight:500,display:"block",marginBottom:"0.375rem"},children:"Total Expenditure"}),W.jsx("div",{style:{fontSize:"1.25rem",fontWeight:700},children:he(me)})]}),W.jsxs("div",{children:[W.jsx("label",{style:{color:"rgba(255,255,255,0.7)",fontSize:"0.875rem",fontWeight:500,display:"block",marginBottom:"0.375rem"},children:"Remaining Balance"}),W.jsx("div",{style:{fontSize:"1.25rem",fontWeight:700,color:ue<0?"#fda4af":"#6ee7b7"},children:he(ue)})]})]}),xe>0&&W.jsxs("div",{style:{marginTop:"2rem"},children:[W.jsxs("div",{className:"flex-between mb-sm",children:[W.jsx("span",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.7)"},children:"Budget Utilization"}),W.jsxs("span",{style:{fontSize:"0.875rem",fontWeight:600},children:[Math.round(pe),"%"]})]}),W.jsx("div",{className:"progress-container",style:{background:"rgba(255,255,255,0.1)",height:"10px"},children:W.jsx("div",{className:"progress-bar",style:{width:`${Math.min(pe,100)}%`,backgroundColor:pe>100?"var(--danger-color)":"var(--success-color)"}})})]})]}),W.jsxs("section",{children:[W.jsxs("div",{className:"flex-between mb-md",children:[W.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[W.jsx(ce,{size:20})," Expense Ledger"]}),W.jsxs("div",{className:"flex gap-sm",children:[W.jsxs("div",{style:{position:"relative",width:"280px"},children:[W.jsx("div",{style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"var(--text-muted)"},children:W.jsx(Q,{size:16})}),W.jsx("input",{type:"text",placeholder:"Search ledger...",value:P,onChange:e=>A(e.target.value),style:{paddingLeft:"34px",paddingRight:"10px",height:"38px"}})]}),W.jsxs("button",{onClick:()=>D(!0),className:"btn btn-secondary",style:{height:"38px"},children:[W.jsx(K,{size:16})," Column"]}),W.jsxs("button",{onClick:async()=>{try{const e=(new Date).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}),s={createdAt:N(),createdByRole:n.role,cellCreators:{}};c.forEach(t=>{"date"===t.id?(s[t.id]=e,s.cellCreators[t.id]=n.role):(s[t.id]="",s.cellCreators[t.id]=n.role)});const r=await w(j(U,"sites",t.id,"expenses"),s);Y("ADD_EXPENSE",{expenseId:r.id,role:n.role})}catch(e){alert("Failed to add row.")}},className:"btn btn-primary",style:{height:"38px"},children:[W.jsx(K,{size:16})," Add Row"]})]})]}),!q&&c.some(e=>"CEO"===e.createdByRole)&&W.jsx("div",{style:{background:"rgba(59, 130, 246, 0.05)",border:"1px solid rgba(59, 130, 246, 0.2)",borderRadius:"8px",padding:"12px 16px",marginBottom:"1.5rem",fontSize:"0.875rem",color:"var(--text-secondary)"},children:W.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[W.jsx("span",{children:"ðŸ”’"}),"Some columns are managed by the CEO and are read-only. You can edit other fields and add new rows."]})}),W.jsx("div",{className:"table-container",children:W.jsxs("table",{children:[W.jsx("thead",{children:W.jsxs("tr",{children:[c.map(e=>W.jsx("th",{style:{width:e.width},children:W.jsxs("div",{className:"flex-between",children:[W.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.name,"CEO"===e.createdByRole&&!q&&W.jsx("span",{title:"This field is managed by CEO - read-only",style:{color:"var(--danger-color)",fontSize:"0.85rem"},children:"ðŸ”’"})]}),q&&"item"!==e.id&&"amount"!==e.id&&"date"!==e.id&&"dailyTotal"!==e.id&&W.jsx("button",{onClick:()=>(e=>{if("item"===e||"amount"===e||"date"===e||"dailyTotal"===e)return void alert("Cannot delete default columns");const t=c.find(t=>t.id===e);if(q||"CEO"!==t?.createdByRole){if(confirm("Delete this column definition?")){const t=c.filter(t=>t.id!==e);m(t),J(t,p,B),Y("DELETE_COLUMN",{columnId:e})}}else alert("âŒ Only a CEO can delete CEO-created columns")})(e.id),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:W.jsx(X,{size:14})})]})},e.id)),W.jsx("th",{style:{width:"120px"},children:"Receipt"}),W.jsx("th",{style:{width:"80px",textAlign:"center"},children:"Actions"})]})}),W.jsx("tbody",{children:h?W.jsx("tr",{children:W.jsx("td",{colSpan:c.length+2,className:"text-center",style:{padding:"3rem"},children:W.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})})}):0===le.length?W.jsx("tr",{children:W.jsx("td",{colSpan:c.length+2,className:"text-center text-muted",style:{padding:"3rem"},children:P?"No expenses match your search":"No expenses recorded yet"})}):le.map(e=>W.jsxs(s.Fragment,{children:[W.jsx("tr",{style:{background:"var(--bg-secondary)",borderLeft:"4px solid var(--accent-color)"},children:W.jsx("td",{colSpan:c.length+2,style:{padding:"8px 12px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-secondary)"},children:W.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[W.jsx(ne,{size:14})," ",e.date,W.jsxs("span",{style:{marginLeft:"auto",opacity:.7},children:["Daily Subtotal: ",he(e.subtotal)]})]})})}),e.rows.map((t,s)=>W.jsx(Fe,{row:t,columns:c,onUpdate:ee,onDelete:te,onUpload:re,isUploading:!!_[t.id],isCEOUser:q,dailyTotalCell:0===s?W.jsx("td",{rowSpan:e.rows.length,style:{verticalAlign:"middle",textAlign:"right",fontWeight:"bold",background:"rgba(var(--accent-rgb), 0.05)",borderLeft:"1px solid var(--border-color)",color:"var(--primary-color)"},children:he(e.subtotal)}):null},t.id))]},e.date))}),ie.length>0&&W.jsx("tfoot",{children:W.jsxs("tr",{style:{background:"#f8fafc",fontWeight:"bold"},children:[W.jsx("td",{colSpan:c.findIndex(e=>"amount"===e.id),className:"text-right",children:"Total:"}),W.jsx("td",{children:he(me)}),W.jsx("td",{colSpan:c.length-c.findIndex(e=>"amount"===e.id)+1})]})})]})})]}),M&&W.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.4)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:W.jsxs("div",{className:"card fade-in",style:{width:"100%",maxWidth:"400px"},children:[W.jsx("h3",{className:"mb-md",children:"Add Custom Column"}),W.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!E.trim())return;const t={id:`col_${Date.now()}`,name:E,type:"text",width:"150px",createdByRole:n.role},s=[...c,t];m(s),J(s,p,B),R(""),D(!1),Y("ADD_COLUMN",{columnName:E,role:n.role})},children:[W.jsxs("div",{className:"input-group",children:[W.jsx("label",{children:"Column Name"}),W.jsx("input",{type:"text",placeholder:"e.g., Vendor, Date, Category",value:E,onChange:e=>R(e.target.value),autoFocus:!0,required:!0})]}),W.jsxs("div",{className:"flex gap-sm mt-lg",children:[W.jsx("button",{type:"submit",className:"btn btn-primary",style:{flex:1},children:"Add Column"}),W.jsx("button",{type:"button",onClick:()=>D(!1),className:"btn btn-secondary",style:{flex:1},children:"Cancel"})]})]})]})})]})}),Re=s.memo(({site:t,user:s,isCEO:r})=>{const[n,a]=e.useState([]),[i,l]=e.useState(!0),[d,c]=e.useState({}),[m,h]=e.useState(null),x=e.useRef(null),p=r();e.useEffect(()=>{const e=u(j(U,"sites",t.id,"plans"),y("createdAt","desc")),s=f(e,e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));a(t),l(!1)},e=>{h("Failed to load plans."),l(!1)});return()=>s()},[t.id]);const g=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]};return W.jsxs("div",{className:"fade-in",children:[W.jsxs("div",{className:"flex-between mb-lg",children:[W.jsxs("div",{children:[W.jsx("h3",{children:"Site Plans & Documents"}),W.jsx("p",{className:"text-secondary",children:"Upload drawings, blueprints, or site progress photos"})]}),W.jsxs("button",{onClick:()=>x.current.click(),className:"btn btn-primary",children:[W.jsx(K,{size:18})," Upload New Plan"]}),W.jsx("input",{type:"file",ref:x,style:{display:"none"},onChange:async e=>{let r=e.target.files[0];if(!r)return;x.current&&(x.current.value="");if(!["image/jpeg","image/png","image/webp","application/pdf"].includes(r.type))return void alert("âŒ Only images (JPG, PNG, WebP) and PDF files are allowed.");if(r.size>2097152)return void alert("âŒ File size exceeds 2MB limit. (Temporary limit until Firebase Storage is enabled)");const n=Date.now().toString(),a=URL.createObjectURL(r);c(e=>({...e,[n]:{name:r.name,progress:0,url:a,type:r.type,status:"compressing"}}));try{r.type.startsWith("image/")&&(r=await ze(r,{maxWidth:1200,maxHeight:1200,quality:.7})),c(e=>({...e,[n]:{...e[n],status:"uploading",progress:50}}));const e=await(e=>new Promise((t,s)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>s(e)}))(r);c(e=>({...e,[n]:{...e[n],progress:80}})),await w(j(U,"sites",t.id,"plans"),{name:r.name,url:e,type:r.type,size:r.size,storageType:"base64",createdAt:N(),createdBy:s.uid,createdByEmail:s.email}),c(e=>({...e,[n]:{...e[n],progress:100}})),setTimeout(()=>{c(e=>{const t={...e};return delete t[n],t})},500)}catch(i){alert("âŒ Failed to save plan: "+i.message),c(e=>{const t={...e};return delete t[n],t})}},accept:"image/*,application/pdf"})]}),i?W.jsx("div",{className:"flex-center",style:{minHeight:"30vh"},children:W.jsx("div",{className:"loading-spinner"})}):0===n.length&&0===Object.keys(d).length?W.jsxs("div",{className:"card flex-center",style:{minHeight:"30vh",flexDirection:"column",gap:"1rem",background:"rgba(0,0,0,0.02)",border:"1px dashed var(--border-color)"},children:[W.jsx("div",{style:{opacity:.3},children:W.jsx(he,{size:48})}),W.jsx("p",{className:"text-secondary",children:"No plans uploaded yet."})]}):W.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"1.5rem"},children:[Object.values(d).map((e,t)=>W.jsxs("div",{className:"card plan-card",style:{padding:0,overflow:"hidden",position:"relative",border:"2px solid var(--primary-color)"},children:[W.jsxs("div",{style:{height:"160px",background:"var(--bg-secondary)",display:"flex",alignItems:"center",justifyItems:"center",justifyContent:"center",borderBottom:"1px solid var(--border-color)",position:"relative"},children:[W.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(255,255,255,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10},children:W.jsx("div",{className:"badge badge-primary",children:"compressing"===e.status?"Compressing...":`${Math.round(e.progress)}%`})}),e.type.includes("image")?W.jsx("img",{src:e.url,alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",opacity:.8}}):W.jsxs("div",{style:{textAlign:"center"},children:[W.jsx("div",{style:{color:"var(--primary-color)",marginBottom:"8px"},children:W.jsx(me,{size:48})}),W.jsx("div",{className:"badge",children:"PDF DOCUMENT"})]})]}),W.jsxs("div",{style:{padding:"1rem"},children:[W.jsx("h4",{style:{margin:"0 0 8px 0",fontSize:"0.95rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.name,children:e.name}),W.jsx("div",{style:{height:"6px",background:"#eee",borderRadius:"3px",overflow:"hidden"},children:W.jsx("div",{style:{height:"100%",background:"var(--success-color)",width:`${e.progress}%`,transition:"width 0.2s ease-out"}})}),W.jsx("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginTop:"4px",textAlign:"right"},children:"compressing"===e.status?"Optimizing...":"Uploading..."})]})]},`upload-${t}`)),n.map(e=>W.jsxs("div",{className:"card plan-card",style:{padding:0,overflow:"hidden",position:"relative"},children:[W.jsx("div",{style:{height:"160px",background:"var(--bg-secondary)",display:"flex",alignItems:"center",justifyItems:"center",justifyContent:"center",borderBottom:"1px solid var(--border-color)"},children:e.type.includes("image")?W.jsx("img",{src:e.url,alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):W.jsxs("div",{style:{textAlign:"center"},children:[W.jsx("div",{style:{color:"var(--primary-color)",marginBottom:"8px"},children:W.jsx(me,{size:48})}),W.jsx("div",{className:"badge",children:"PDF DOCUMENT"})]})}),W.jsxs("div",{style:{padding:"1rem"},children:[W.jsx("h4",{style:{margin:"0 0 4px 0",fontSize:"0.95rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.name,children:e.name}),W.jsxs("div",{className:"flex-between",children:[W.jsx("span",{className:"text-muted",style:{fontSize:"0.75rem"},children:g(e.size)}),W.jsxs("div",{className:"flex gap-sm",children:[W.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary btn-small",title:"View/Download",children:W.jsx(Z,{size:14})}),p&&W.jsx("button",{onClick:()=>(async e=>{if(p){if(confirm(`Delete plan "${e.name}"?`))try{await b(o(U,"sites",t.id,"plans",e.id))}catch(s){alert("âŒ Failed to delete plan.")}}else alert("âŒ Only CEO can delete plans.")})(e),className:"btn btn-danger btn-small",title:"Delete",children:W.jsx(X,{size:14})})]})]})]})]},e.id))]})]})}),Me=s.memo(({site:t,user:s,isCEO:r})=>{const[n,a]=e.useState([]),[i,l]=e.useState(!0),[d,c]=e.useState(!1),[m,h]=e.useState(t.contractValue||0),[x,p]=e.useState(!1),[g,S]=e.useState(0),C=r();e.useEffect(()=>{const e=u(j(U,"sites",t.id,"payments"),y("date","desc")),s=f(e,e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));a(t),l(!1)},e=>{l(!1)});return()=>s()},[t.id]),e.useEffect(()=>{const e=u(j(U,"sites",t.id,"expenses")),s=f(e,e=>{let t=0;e.docs.forEach(e=>{const s=e.data();Object.entries(s).forEach(([e,s])=>{if("createdAt"===e||"updatedAt"===e||"createdByRole"===e||"lastUpdatedByRole"===e||"cellCreators"===e||"receiptUrl"===e||"receiptName"===e||"receiptSize"===e||"receiptType"===e||"uploadedAt"===e||e.toLowerCase().includes("date")||"item"===e||"dailyTotal"===e)return;const r=parseFloat(s);isNaN(r)||(t+=r)})}),S(t)});return()=>s()},[t.id]);const k=n.reduce((e,t)=>e+(t.amount||0),0),z=m-k,B=k-g,F=m>0?(B/m*100).toFixed(1):0,E=m>0?(k/m*100).toFixed(1):0,R=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),M=e=>{if(!e)return"";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})};return W.jsxs("div",{className:"fade-in",children:[W.jsxs("div",{className:"card mb-lg",style:{background:"var(--primary-color)",color:"white",border:"none"},children:[W.jsxs("div",{className:"flex-between mb-md",children:[W.jsxs("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:[W.jsx(pe,{size:28})," Project Financials"]}),C&&!x&&W.jsxs("button",{onClick:()=>p(!0),className:"btn",style:{background:"white",color:"var(--primary-color)",border:"none",fontWeight:"bold"},children:[W.jsx(ge,{size:16})," Edit Contract"]})]}),x?W.jsxs("div",{className:"flex gap-sm",style:{alignItems:"center"},children:[W.jsx("label",{style:{fontWeight:"bold"},children:"Contract Value:"}),W.jsx("input",{type:"number",value:m,onChange:e=>h(e.target.value),placeholder:"Enter contract value",style:{flex:1,maxWidth:"200px"}}),W.jsx("button",{onClick:async()=>{if(C)try{await v(o(U,"sites",t.id),{contractValue:Number(m)}),p(!1),alert("âœ… Contract value updated!")}catch(e){alert("âŒ Failed to update contract value")}},className:"btn btn-success",children:"Save"}),W.jsx("button",{onClick:()=>{h(t.contractValue||0),p(!1)},className:"btn",style:{background:"white",color:"var(--primary-color)",border:"none"},children:"Cancel"})]}):W.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem"},children:[W.jsxs("div",{children:[W.jsx("p",{style:{opacity:.9,fontSize:"0.875rem",margin:"0 0 4px 0"},children:"Contract Value"}),W.jsx("h2",{style:{margin:0,color:"white"},children:R(m)})]}),W.jsxs("div",{children:[W.jsx("p",{style:{opacity:.9,fontSize:"0.875rem",margin:"0 0 4px 0"},children:"Total Received"}),W.jsxs("h2",{style:{margin:0,color:"white"},children:[R(k)," ",W.jsxs("span",{style:{fontSize:"1rem",opacity:.8},children:["(",E,"%)"]})]}),W.jsx("div",{style:{height:"6px",background:"rgba(255,255,255,0.3)",borderRadius:"3px",marginTop:"8px"},children:W.jsx("div",{style:{height:"100%",background:"white",width:`${E}%`,borderRadius:"3px",transition:"width 0.3s"}})})]}),W.jsxs("div",{children:[W.jsx("p",{style:{opacity:.9,fontSize:"0.875rem",margin:"0 0 4px 0"},children:"Balance Due"}),W.jsx("h2",{style:{margin:0,color:"white"},children:R(z)})]})]})]}),W.jsxs("div",{className:"card mb-lg",children:[W.jsxs("h3",{className:"flex",style:{alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[W.jsx(re,{size:24})," Profit Analysis"]}),W.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"1rem"},children:[W.jsxs("div",{className:"flex",style:{flexDirection:"column"},children:[W.jsx("span",{className:"text-secondary",style:{fontSize:"0.875rem"},children:"Total Expenses"}),W.jsx("span",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--danger-color)"},children:R(g)})]}),W.jsxs("div",{className:"flex",style:{flexDirection:"column"},children:[W.jsx("span",{className:"text-secondary",style:{fontSize:"0.875rem"},children:"Net Profit"}),W.jsx("span",{style:{fontSize:"1.5rem",fontWeight:"bold",color:B>=0?"var(--success-color)":"var(--danger-color)"},children:R(B)})]}),W.jsxs("div",{className:"flex",style:{flexDirection:"column"},children:[W.jsx("span",{className:"text-secondary",style:{fontSize:"0.875rem"},children:"Profit Margin"}),W.jsxs("span",{style:{fontSize:"1.5rem",fontWeight:"bold",color:F>=0?"var(--success-color)":"var(--danger-color)"},children:[F,"%"]})]})]})]}),W.jsxs("div",{className:"flex-between mb-md",children:[W.jsxs("h3",{className:"flex",style:{alignItems:"center",gap:"0.5rem"},children:[W.jsx(ue,{size:24})," Payment History"]}),C&&W.jsxs("button",{onClick:()=>c(!d),className:"btn btn-primary",children:[W.jsx(K,{size:18})," ",d?"Cancel":"Add Payment"]})]}),d&&W.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!C)return;const r=new FormData(e.target),n=Number(r.get("amount")),a=new Date(r.get("date")),i=r.get("method"),l=r.get("notes");try{await w(j(U,"sites",t.id,"payments"),{amount:n,date:a,method:i,notes:l,createdAt:N(),createdBy:s.uid,createdByEmail:s.email}),c(!1),e.target.reset(),alert("âœ… Payment added successfully!")}catch(o){const e="permission-denied"===o.code?"âŒ Permission denied. Check Firestore security rules for 'payments' collection.":`âŒ Failed to add payment: ${o.message}`;alert(e)}},className:"card mb-lg",children:[W.jsx("h4",{children:"New Payment"}),W.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:[W.jsxs("div",{children:[W.jsx("label",{children:"Amount *"}),W.jsx("input",{type:"number",name:"amount",required:!0,placeholder:"â‚¹ 0",min:"0",step:"0.01"})]}),W.jsxs("div",{children:[W.jsx("label",{children:"Date *"}),W.jsx("input",{type:"date",name:"date",required:!0,defaultValue:(new Date).toISOString().split("T")[0]})]}),W.jsxs("div",{children:[W.jsx("label",{children:"Payment Method *"}),W.jsxs("select",{name:"method",required:!0,children:[W.jsx("option",{value:"cash",children:"Cash"}),W.jsx("option",{value:"bank",children:"Bank Transfer"}),W.jsx("option",{value:"cheque",children:"Cheque"}),W.jsx("option",{value:"upi",children:"UPI"})]})]})]}),W.jsxs("div",{style:{marginTop:"1rem"},children:[W.jsx("label",{children:"Notes"}),W.jsx("textarea",{name:"notes",rows:"2",placeholder:"Payment description or milestone"})]}),W.jsxs("button",{type:"submit",className:"btn btn-primary",style:{marginTop:"1rem"},children:[W.jsx(ye,{size:18})," Save Payment"]})]}),i?W.jsx("div",{className:"flex-center",style:{minHeight:"20vh"},children:W.jsx("div",{className:"loading-spinner"})}):0===n.length?W.jsxs("div",{className:"card flex-center",style:{minHeight:"20vh",flexDirection:"column",gap:"1rem",background:"rgba(0,0,0,0.02)",border:"1px dashed var(--border-color)"},children:[W.jsx("div",{style:{opacity:.3},children:W.jsx(ue,{size:48})}),W.jsx("p",{className:"text-secondary",children:"No payments recorded yet."})]}):W.jsx("div",{className:"card",style:{padding:0},children:n.map((e,s)=>W.jsxs("div",{style:{padding:"1rem 1.5rem",borderBottom:s<n.length-1?"1px solid var(--border-color)":"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[W.jsxs("div",{style:{flex:1},children:[W.jsxs("div",{className:"flex gap-md",style:{alignItems:"center",marginBottom:"0.25rem"},children:[W.jsx("h4",{style:{margin:0},children:R(e.amount)}),W.jsxs("span",{className:"badge",children:["cash"===e.method&&"ðŸ’µ Cash","bank"===e.method&&"ðŸ¦ Bank","cheque"===e.method&&"ðŸ“ Cheque","upi"===e.method&&"ðŸ“± UPI"]})]}),W.jsxs("p",{className:"text-secondary",style:{fontSize:"0.875rem",margin:"0.25rem 0"},children:[W.jsx(ne,{size:14})," ",M(e.date)]}),e.notes&&W.jsx("p",{style:{fontSize:"0.875rem",margin:"0.5rem 0 0 0",fontStyle:"italic"},children:e.notes})]}),C&&W.jsx("button",{onClick:()=>(async e=>{if(C&&confirm("Delete this payment record?"))try{await b(o(U,"sites",t.id,"payments",e))}catch(s){alert("âŒ Failed to delete payment")}})(e.id),className:"btn btn-danger btn-small",title:"Delete",children:W.jsx(X,{size:14})})]},e.id))})]})}),De=s.memo(({site:t,onBack:s,user:r,isCEO:n})=>{const[a,i]=e.useState("expenses");return W.jsxs("div",{className:"site-detail-container",children:[W.jsx("div",{className:"sticky-header",style:{background:"var(--bg-main)",borderBottom:"1px solid var(--border-color)",marginBottom:"1rem"},children:W.jsx("div",{className:"container",children:W.jsxs("div",{className:"flex-between py-md",children:[W.jsxs("div",{className:"flex gap-md align-center",children:[W.jsx("button",{onClick:s,className:"btn btn-secondary btn-small",style:{padding:"8px"},children:W.jsx(oe,{size:18})}),W.jsxs("div",{children:[W.jsx("h3",{style:{margin:0},children:t.name}),W.jsx("p",{className:"text-secondary",style:{fontSize:"0.75rem",margin:0},children:t.location})]})]}),W.jsxs("div",{className:"flex gap-sm bg-secondary p-xs",style:{borderRadius:"8px",background:"rgba(0,0,0,0.05)",padding:"4px"},children:[W.jsxs("button",{onClick:()=>i("expenses"),className:"btn btn-small "+("expenses"===a?"btn-primary":""),style:{border:"none",boxShadow:"expenses"===a?"0 2px 4px rgba(0,0,0,0.1)":"none"},children:[W.jsx(ce,{size:16})," Daily Expense"]}),W.jsxs("button",{onClick:()=>i("plans"),className:"btn btn-small "+("plans"===a?"btn-primary":""),style:{border:"none",boxShadow:"plans"===a?"0 2px 4px rgba(0,0,0,0.1)":"none"},children:[W.jsx(me,{size:16})," Site Plan Saver"]}),W.jsxs("button",{onClick:()=>i("payments"),className:"btn btn-small "+("payments"===a?"btn-primary":""),style:{border:"none",boxShadow:"payments"===a?"0 2px 4px rgba(0,0,0,0.1)":"none"},children:[W.jsx(xe,{size:16})," Client Payments"]})]})]})})}),W.jsxs("div",{className:"container",children:["expenses"===a&&W.jsx("div",{className:"fade-in",children:W.jsx(Ee,{site:t,onBack:s,user:r,isCEO:n,hideHeader:!0})}),"plans"===a&&W.jsx("div",{className:"fade-in",children:W.jsx(Re,{site:t,user:r,isCEO:n})}),"payments"===a&&W.jsx("div",{className:"fade-in",children:W.jsx(Me,{site:t,user:r,isCEO:n})})]})]})}),Ie=()=>W.jsxs("div",{className:"flex-center",style:{minHeight:"100vh",flexDirection:"column"},children:[W.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem",animation:"pulse 1.5s infinite"},children:"ðŸ—ï¸"}),W.jsx("h2",{children:"Loading..."}),W.jsx("p",{className:"text-muted",style:{marginBottom:"1.5rem"},children:"Connecting to construction database..."}),W.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-secondary btn-small",style:{opacity:.7},children:"ðŸ”„ Refresh App"})]}),Le=()=>{const{user:t,loading:s,isCEO:r}=q(),[n,a]=e.useState(null);return s?W.jsx(Ie,{}):t?n?W.jsx(De,{site:n,onBack:()=>{a(null)},user:t,isCEO:r}):W.jsx(ke,{onSelectSite:e=>{a(e)}}):W.jsx(be,{})};function We(){return W.jsx($,{children:W.jsx(e.Suspense,{fallback:W.jsx(Ie,{}),children:W.jsx(Le,{})})})}T.createRoot(document.getElementById("root")).render(W.jsx(s.StrictMode,{children:W.jsx(We,{})}));
