import{r as e,a as t,R as r}from"./vendor-CzsvKnaC.js";import{i as s,g as n,a,b as i,o,d as l,c as d,s as c,e as u,R as m,f as p,h as x,q as h,l as g,j as y,k as j,m as f,n as b,p as v,r as w,u as S,t as C,v as N,w as k}from"./firebase-DkQAvng4.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var E={exports:{}},I={},B=e,O=Symbol.for("react.element"),_=Symbol.for("react.fragment"),z=Object.prototype.hasOwnProperty,D=B.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,R={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,r){var s,n={},a=null,i=null;for(s in void 0!==r&&(a=""+r),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(i=t.ref),t)z.call(t,s)&&!R.hasOwnProperty(s)&&(n[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===n[s]&&(n[s]=t[s]);return{$$typeof:O,type:e,key:a,ref:i,props:n,_owner:D.current}}I.Fragment=_,I.jsx=T,I.jsxs=T,E.exports=I;var M=E.exports,L={},A=t;L.createRoot=A.createRoot,L.hydrateRoot=A.hydrateRoot;const P={apiKey:"AIzaSyAmWH_Vwhrok_r_lUsjgT2V_P_d63Dly98",authDomain:"construction-da7de.firebaseapp.com",projectId:"construction-da7de",storageBucket:"construction-da7de.firebasestorage.app",messagingSenderId:"557692258606",appId:"1:557692258606:web:283a05beed9e7079fad2bf"},F=s(P),U=n(F),W=a(F),V=i(F),$=e.createContext(),Y=()=>{const t=e.useContext($);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},H=({children:t})=>{const[s,n]=e.useState(null),[a,i]=e.useState(!0),h=r.useRef({});e.useEffect(()=>{const e=sessionStorage.getItem("current_user_session");if(e)try{const t=JSON.parse(e);return n(t),void i(!1)}catch(t){}i(!1)},[]),e.useEffect(()=>{if(!U)return;if(sessionStorage.getItem("current_user_session"))return;return o(U,async e=>{if(e)try{const r=l(W,"users",e.uid),s=new Promise((e,t)=>setTimeout(()=>t(new Error("Firestore timeout")),15e3)),a=await Promise.race([d(r),s]);let o="Member";if(a.exists())o=a.data().role;else try{await c(l(W,"users",e.uid),{email:e.email||"",phoneNumber:e.phoneNumber||"",role:"Member",createdAt:(new Date).toISOString()})}catch(t){}const u={uid:e.uid,email:e.email,phoneNumber:e.phoneNumber,role:o,name:e.displayName||(e.email?e.email.split("@")[0]:e.phoneNumber||"User")};sessionStorage.setItem("current_user_session",JSON.stringify(u)),h.current[e.uid]=u,n(u),i(!1)}catch(r){i(!1)}else{sessionStorage.getItem("current_user_session")||n(null),i(!1)}})},[]);const g={user:s,signupEmail:async(e,t,r)=>{if(!U)throw new Error("Firebase not configured");const s=await x(U,e,t),a=r&&"CEO123"===r?"CEO":"Member";await c(l(W,"users",s.user.uid),{email:e,role:a,createdAt:(new Date).toISOString()});const i={uid:s.user.uid,email:e,role:a,name:e.split("@")[0]};return sessionStorage.setItem("current_user_session",JSON.stringify(i)),h.current[s.user.uid]=i,n(i),s.user},loginEmail:async(e,t)=>{if(!U)throw new Error("Firebase not configured");const r=await p(U,e,t),s=l(W,"users",r.user.uid),a=await d(s),i=a.exists()?a.data().role:"Member",o={uid:r.user.uid,email:r.user.email,role:i,name:r.user.displayName||e.split("@")[0]};return sessionStorage.setItem("current_user_session",JSON.stringify(o)),h.current[r.user.uid]=o,n(o),r.user},setupRecaptcha:e=>{if(!U)throw new Error("Firebase not configured");if(!window.recaptchaVerifier)try{window.recaptchaVerifier=new m(U,e,{size:"invisible",callback:e=>{}})}catch(t){}},sendPhoneOtp:async e=>{if(!U)throw new Error("Firebase not configured");const t=window.recaptchaVerifier;return u(U,e,t)},logout:async()=>{try{sessionStorage.removeItem("current_user_session"),sessionStorage.removeItem("temp_role"),n(null),i(!1)}catch(e){throw e}},isCEO:()=>"CEO"===s?.role,upgradeToCEO:async e=>{if(!U.currentUser)return!1;if("CEO123"!==e.trim())return!1;try{const e=new Promise((e,t)=>setTimeout(()=>t(new Error("Firestore update timed out")),1e4));return await Promise.race([c(l(W,"users",U.currentUser.uid),{role:"CEO",updatedAt:(new Date).toISOString()},{merge:!0}),e]),n(e=>{const t={...e,role:"CEO"};return h.current[U.currentUser.uid]=t,sessionStorage.setItem("current_user_session",JSON.stringify(t)),t}),sessionStorage.removeItem("temp_role"),!0}catch(t){return n(e=>{const t={...e,role:"CEO"};return h.current[U.currentUser.uid]=t,sessionStorage.setItem("current_user_session",JSON.stringify(t)),t}),t.message.includes("timed out")?alert("âš ï¸ Backend Connection Failed!\n\nI have upgraded you to CEO LOCALLY so you can continue working.\n\nTo fix the backend permanently:\n1. Go to Firebase Console > Firestore Database\n2. Click 'Create Database'"):alert("âš ï¸ Update failed: "+t.message+"\n\nSwitched to Offline CEO Mode."),!0}},loading:a};return M.jsx($.Provider,{value:g,children:t})},q=()=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("path",{d:"M2 6h20v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6Z"}),M.jsx("path",{d:"M17 16v5"}),M.jsx("path",{d:"M7 16v5"}),M.jsx("path",{d:"M12 16v5"}),M.jsx("path",{d:"M17 3v3"}),M.jsx("path",{d:"M7 3v3"}),M.jsx("path",{d:"M12 3v3"}),M.jsx("path",{d:"m10 16 4-10"}),M.jsx("path",{d:"m14 16-4-10"})]}),G=()=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",ry:"2"}),M.jsx("path",{d:"M9 22v-4h6v4"}),M.jsx("path",{d:"M8 6h.01"}),M.jsx("path",{d:"M16 6h.01"}),M.jsx("path",{d:"M8 10h.01"}),M.jsx("path",{d:"M16 10h.01"}),M.jsx("path",{d:"M8 14h.01"}),M.jsx("path",{d:"M16 14h.01"}),M.jsx("path",{d:"M12 6h.01"}),M.jsx("path",{d:"M12 10h.01"}),M.jsx("path",{d:"M12 14h.01"})]}),J=()=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("path",{d:"M3 6h18"}),M.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),M.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),M.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),M.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),K=()=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("path",{d:"M5 12h14"}),M.jsx("path",{d:"M12 5v14"})]}),X=()=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),M.jsx("polyline",{points:"7 10 12 15 17 10"}),M.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),Z=()=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("circle",{cx:"11",cy:"11",r:"8"}),M.jsx("path",{d:"m21 21-4.3-4.3"})]}),Q=()=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),M.jsx("circle",{cx:"12",cy:"13",r:"3"})]}),ee=()=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),M.jsx("polyline",{points:"16 17 21 12 16 7"}),M.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),te=()=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),M.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),re=({size:e=20})=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),M.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),M.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),M.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),se=({size:e=20})=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),M.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),ne=({size:e=20})=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24"}),M.jsx("path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"}),M.jsx("path",{d:"M6.61 6.61A13.52 13.52 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"}),M.jsx("line",{x1:"2",y1:"2",x2:"22",y2:"22"})]}),ae=({size:e=20})=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("circle",{cx:"12",cy:"12",r:"10"}),M.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),M.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),ie=({size:e=20})=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("path",{d:"m12 19-7-7 7-7"}),M.jsx("path",{d:"M19 12H5"})]}),oe=({size:e=20})=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"}),M.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),le=({size:e=20})=>M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[M.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),M.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),M.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),M.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),M.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),M.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),de=r.memo(()=>{const[t,r]=e.useState("email"),[s,n]=e.useState(!1),[a,i]=e.useState(""),[o,l]=e.useState(""),[d,c]=e.useState(!1),[u,m]=e.useState(""),[p,x]=e.useState(""),[h,g]=e.useState(""),[y,j]=e.useState("input"),[f,b]=e.useState(null),[v,w]=e.useState(""),[S,C]=e.useState(!1),[N,k]=e.useState(!P.apiKey),{loginEmail:E,signupEmail:I,setupRecaptcha:B,sendPhoneOtp:O}=Y();e.useEffect(()=>{if("phone"===t&&"input"===y)try{B("recaptcha-container")}catch(e){}},[t,y]);return M.jsxs("div",{className:"flex-center",style:{minHeight:"100vh",padding:"1rem",background:"var(--bg-main)"},children:[N&&M.jsxs("div",{className:"card fade-in",style:{maxWidth:"500px",width:"100%",border:"2px solid var(--danger-color)",marginBottom:"2rem"},children:[M.jsxs("h2",{style:{color:"var(--danger-color)",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:[M.jsx(ae,{size:24})," Configuration Required"]}),M.jsxs("p",{style:{marginBottom:"1rem"},children:["The application requires Firebase credentials to function. Please set up your ",M.jsx("code",{children:".env"})," file with the following keys:"]}),M.jsx("div",{style:{background:"var(--bg-secondary)",padding:"1rem",borderRadius:"var(--radius-md)",marginBottom:"1rem",fontFamily:"monospace",fontSize:"0.85rem",overflowX:"auto",border:"1px solid var(--border-color)"},children:M.jsx("pre",{style:{margin:0},children:"VITE_FIREBASE_API_KEY=...\nVITE_FIREBASE_AUTH_DOMAIN=...\nVITE_FIREBASE_PROJECT_ID=...\nVITE_FIREBASE_STORAGE_BUCKET=...\nVITE_FIREBASE_MESSAGING_SENDER_ID=...\nVITE_FIREBASE_APP_ID=...\nVITE_ADMIN_SIGNUP_CODE=..."})}),M.jsx("button",{onClick:()=>k(!1),className:"btn btn-secondary",style:{width:"100%"},children:"I've configured it, refresh app"})]}),M.jsxs("div",{className:"card fade-in",style:{maxWidth:"420px",width:"100%",padding:"2.5rem"},children:[M.jsxs("div",{className:"text-center mb-lg",children:[M.jsx("div",{style:{color:"var(--primary-color)",marginBottom:"1rem"},children:M.jsx(q,{size:48})}),M.jsx("h1",{style:{marginBottom:"0.5rem",fontSize:"1.75rem"},children:"BR CONSTRUCTION"}),M.jsx("p",{className:"text-secondary",children:s?"Create your professional account":"Sign in to your project dashboard"})]}),M.jsxs("div",{className:"flex mb-lg",style:{background:"var(--bg-secondary)",borderRadius:"var(--radius-md)",padding:"4px",border:"1px solid var(--border-color)"},children:[M.jsx("button",{type:"button",className:"btn "+("email"===t?"btn-primary":""),style:{flex:1,background:"email"===t?"":"transparent",boxShadow:"none",color:"email"===t?"white":"var(--text-secondary)"},onClick:()=>{r("email"),w("")},children:"Email"}),M.jsx("button",{type:"button",className:"btn "+("phone"===t?"btn-primary":""),style:{flex:1,background:"phone"===t?"":"transparent",boxShadow:"none",color:"phone"===t?"white":"var(--text-secondary)"},onClick:()=>{r("phone"),w("")},children:"Phone"})]}),"email"===t&&M.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(""),C(!0);try{s?await I(a,o,h):await E(a,o)}catch(t){w(t.message.replace("Firebase: ",""))}C(!1)},children:[M.jsxs("div",{className:"input-group",children:[M.jsx("label",{children:"Email Address"}),M.jsx("input",{type:"email",placeholder:"name@company.com",value:a,onChange:e=>i(e.target.value),required:!0})]}),M.jsxs("div",{className:"input-group",children:[M.jsx("label",{children:"Password"}),M.jsxs("div",{style:{position:"relative"},children:[M.jsx("input",{type:d?"text":"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:o,onChange:e=>l(e.target.value),required:!0,style:{paddingRight:"40px"}}),M.jsx("button",{type:"button",onClick:()=>c(!d),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:d?M.jsx(ne,{size:18}):M.jsx(se,{size:18})})]})]}),s&&M.jsxs("div",{className:"input-group",children:[M.jsx("label",{children:"CEO Access Code (Optional)"}),M.jsx("input",{type:"text",placeholder:"Enter code for administrative access",value:h,onChange:e=>g(e.target.value)})]}),v&&M.jsx("div",{className:"text-danger mb-md",style:{fontSize:"0.875rem"},children:v}),M.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%",marginTop:"1rem"},disabled:S,children:S?M.jsx("span",{className:"loading-spinner-small"}):s?"Create Account":"Sign In"})]}),"phone"===t&&"input"===y&&M.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(""),C(!0);try{const e=await O(u);b(e),j("verify")}catch(t){let e=t.message.replace("Firebase: ","");(e.includes("billing")||e.includes("quota"))&&(e="âš ï¸ SMS limit reached or billing not enabled. Please use a TEST PHONE NUMBER defined in Firebase Console."),w(e)}C(!1)},children:[M.jsxs("div",{className:"input-group",children:[M.jsx("label",{children:"Phone Number"}),M.jsx("input",{type:"tel",placeholder:"+91 98765 43210",value:u,onChange:e=>m(e.target.value),required:!0})]}),M.jsx("div",{id:"recaptcha-container",style:{marginBottom:"1rem"}}),v&&M.jsx("div",{className:"text-danger mb-md",style:{fontSize:"0.875rem"},children:v}),M.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%"},disabled:S,children:S?M.jsx("span",{className:"loading-spinner-small"}):"Send Verification Code"})]}),"phone"===t&&"verify"===y&&M.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(""),C(!0);try{await f.confirm(p)}catch(t){w(t.message.replace("Firebase: ",""))}C(!1)},children:[M.jsxs("div",{className:"input-group",children:[M.jsx("label",{children:"Verification Code"}),M.jsx("input",{type:"text",placeholder:"000000",value:p,onChange:e=>x(e.target.value),required:!0,style:{textAlign:"center",letterSpacing:"8px",fontSize:"1.25rem",fontWeight:700}})]}),v&&M.jsx("div",{className:"text-danger mb-md",style:{fontSize:"0.875rem"},children:v}),M.jsx("button",{type:"submit",className:"btn btn-success",style:{width:"100%"},disabled:S,children:S?M.jsx("span",{className:"loading-spinner-small"}):"Verify & Sign In"}),M.jsx("button",{type:"button",className:"btn btn-secondary",style:{width:"100%",marginTop:"0.75rem"},onClick:()=>j("input"),children:"Back"})]}),"email"===t&&M.jsx("div",{className:"text-center mt-lg",children:M.jsx("button",{className:"text-primary",style:{background:"none",border:"none",cursor:"pointer",fontSize:"0.875rem",fontWeight:600},onClick:()=>n(!s),children:s?"Already have an account? Sign In":"Need an account? Create one"})})]}),S&&M.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(15, 23, 42, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,flexDirection:"column",color:"white",backdropFilter:"blur(8px)"},children:[M.jsx("div",{className:"loading-spinner",style:{marginBottom:"1.5rem"}}),M.jsx("h2",{style:{marginBottom:"0.5rem"},children:"Authenticating..."}),M.jsx("p",{style:{opacity:.7},children:"Please wait while we verify your credentials."})]})]})}),ce=r.memo(({onSelectSite:t})=>{const{user:s,logout:n,isCEO:a,upgradeToCEO:i}=Y(),[o,d]=e.useState([]),[c,u]=e.useState(!1),[m,p]=e.useState(""),[x,w]=e.useState(""),[S,C]=e.useState(!0),[N,k]=e.useState(null),[E,I]=e.useState(!1),[B,O]=e.useState(!1),_=r.useRef(null);e.useEffect(()=>{I(a())},[s?.role,a]),e.useEffect(()=>{try{_.current=new BroadcastChannel("site_updates"),_.current.onmessage=e=>{"site_added"===e.data.type||"sites_updated"===e.data.type||e.data.type}}catch(e){}return()=>{_.current&&_.current.close()}},[]),e.useEffect(()=>{const e=h(j(W,"sites"),y("createdAt","desc"),g(100)),t=f(e,e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));d(t),C(!1),k(null),_.current&&_.current.postMessage({type:"sites_updated",count:t.length,timestamp:(new Date).toISOString()})},e=>{k("Failed to load sites. Check your internet connection or Firebase permissions."),C(!1)});return()=>t()},[]);return M.jsxs("div",{className:"container fade-in",style:{paddingTop:"3rem",paddingBottom:"3rem"},children:[M.jsxs("header",{className:"flex-between mb-lg",style:{alignItems:"flex-end",borderBottom:"1px solid var(--border-color)",paddingBottom:"1.5rem"},children:[M.jsxs("div",{children:[M.jsxs("div",{className:"flex gap-sm mb-sm",style:{alignItems:"center"},children:[M.jsx("div",{style:{color:"var(--accent-color)"},children:M.jsx(q,{size:28})}),M.jsx("h1",{style:{margin:0},children:"Project Dashboard"})]}),M.jsxs("p",{className:"text-secondary",style:{fontSize:"0.9375rem"},children:["Managing ",M.jsx("strong",{className:"text-main",children:o.length})," active construction sites"]})]}),M.jsxs("div",{className:"flex gap-md",style:{alignItems:"center"},children:[M.jsxs("div",{className:"text-right mr-md",style:{textAlign:"right",marginRight:"1rem"},children:[M.jsx("div",{style:{fontSize:"0.875rem",fontWeight:600},children:s.name}),M.jsx("div",{className:"badge badge-primary",children:s.role})]}),M.jsxs("button",{onClick:async()=>{try{await n()}catch(e){alert("Error signing out. Please try again.")}},className:"btn btn-secondary",style:{padding:"0.5rem 1rem"},children:[M.jsx(ee,{size:18})," Sign Out"]})]})]}),M.jsxs("div",{className:"flex-between mb-lg",children:[M.jsx("div",{className:"flex gap-md",style:{flex:1,maxWidth:"600px"},children:M.jsxs("div",{style:{position:"relative",flex:1},children:[M.jsx("div",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-muted)"},children:M.jsx(Z,{size:18})}),M.jsx("input",{type:"text",placeholder:"Search projects by name or location...",style:{paddingLeft:"40px"}})]})}),E&&M.jsxs("button",{onClick:()=>u(!0),className:"btn btn-primary",children:[M.jsx(K,{size:18})," Create New Project"]}),!E&&M.jsx("button",{onClick:async()=>{const e=prompt("Enter CEO Secret Code:");if(e){O(!0);try{await i(e)?alert("Successfully upgraded to CEO role."):alert("Invalid code.")}catch(t){alert("An error occurred during upgrade.")}O(!1)}},disabled:B,className:"btn btn-secondary",children:B?"Verifying...":"Upgrade to CEO"})]}),c&&M.jsxs("div",{className:"card mb-lg fade-in",style:{maxWidth:"600px",margin:"0 auto 2rem"},children:[M.jsxs("div",{className:"flex-between mb-md",children:[M.jsx("h3",{children:"New Project Details"}),M.jsx("button",{onClick:()=>u(!1),className:"btn btn-secondary",style:{padding:"4px 8px"},children:"âœ•"})]}),M.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),m.trim())if(s)if(E)try{const e={name:m.trim(),location:x.trim()||"Not specified",createdAt:(new Date).toISOString(),createdBy:s.uid,createdByEmail:s.email,expenseColumns:[{id:"item",name:"Item Description",type:"text",width:"200px"},{id:"date",name:"Date",type:"text",width:"120px"},{id:"amount",name:"Amount (â‚¹)",type:"number",width:"120px"},{id:"dailyTotal",name:"Daily Total",type:"number",width:"120px"}],ceoBudget:"",ceoProjectValue:""},t=await b(j(W,"sites"),e);_.current&&_.current.postMessage({type:"site_added",siteId:t.id,siteName:m,timestamp:(new Date).toISOString()}),p(""),w(""),u(!1),alert("âœ… Site added successfully!")}catch(t){alert("âŒ Failed to add site:\n"+t.message+"\n\nCheck console for details.")}else alert("âŒ Only CEO users can add sites. Your role: "+s.role);else alert("âŒ You must be logged in to add sites");else alert("âŒ Please enter a site name")},children:[M.jsxs("div",{className:"input-group",children:[M.jsx("label",{children:"Project Name"}),M.jsx("input",{type:"text",placeholder:"e.g., Sky Tower Phase 1",value:m,onChange:e=>p(e.target.value),required:!0})]}),M.jsxs("div",{className:"input-group",children:[M.jsx("label",{children:"Location"}),M.jsx("input",{type:"text",placeholder:"e.g., North District, Block C",value:x,onChange:e=>w(e.target.value)})]}),M.jsxs("div",{className:"flex gap-sm",style:{justifyContent:"flex-end"},children:[M.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn btn-secondary",children:"Cancel"}),M.jsx("button",{type:"submit",className:"btn btn-primary",children:"Initialize Project"})]})]})]}),N&&M.jsx("div",{className:"card mb-lg",style:{borderLeft:"4px solid var(--danger-color)"},children:M.jsxs("div",{className:"flex gap-md",children:[M.jsx("div",{className:"text-danger",children:M.jsx(ae,{size:24})}),M.jsxs("div",{children:[M.jsx("h4",{className:"text-danger",children:"System Error"}),M.jsx("p",{className:"text-secondary",children:N})]})]})}),S?M.jsxs("div",{className:"flex-center",style:{minHeight:"40vh",flexDirection:"column",gap:"1rem"},children:[M.jsx("div",{className:"loading-spinner"}),M.jsx("p",{className:"text-secondary",children:"Synchronizing project data..."})]}):M.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(340px, 1fr))",gap:"1.5rem"},children:o.map((e,r)=>M.jsxs("div",{className:"card fade-in",onClick:()=>{t(e)},style:{cursor:"pointer",animationDelay:.05*r+"s",display:"flex",flexDirection:"column",justifyContent:"space-between",minHeight:"180px",position:"relative",userSelect:"none",outline:"none",border:"1px solid var(--border-color)",background:"var(--card-bg, #fff)",padding:"1.5rem",font:"inherit",textAlign:"left",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.04)"},tabIndex:0,role:"button",children:[E&&e.createdBy===s.uid&&M.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px",display:"flex",gap:"6px"},children:[M.jsx("button",{onClick:e=>{e.stopPropagation(),e.preventDefault()},style:{background:"var(--primary-color)",color:"white",border:"none",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"0.75rem",fontWeight:600},children:"Edit"}),M.jsx("button",{onClick:t=>{t.stopPropagation(),t.preventDefault(),confirm(`Delete "${e.name}"?`)&&(async(e,t)=>{try{await v(l(W,"sites",e)),_.current&&_.current.postMessage({type:"site_deleted",siteId:e,siteName:t,timestamp:(new Date).toISOString()}),alert(`âœ… "${t}" has been deleted.`)}catch(r){alert("âŒ Failed to delete site:\n"+r.message)}})(e.id,e.name)},style:{background:"var(--danger-color)",color:"white",border:"none",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"0.75rem",fontWeight:600},children:"Delete"})]}),M.jsxs("div",{children:[M.jsxs("div",{className:"flex-between mb-sm",children:[M.jsx("div",{className:"badge badge-primary",children:"Active Project"}),M.jsxs("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:["ID: ",e.id.substring(0,8)]})]}),M.jsx("h3",{className:"mb-sm",style:{color:"var(--primary-color)"},children:e.name}),M.jsxs("p",{className:"text-secondary",style:{fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"4px"},children:[M.jsx(oe,{size:14})," ",e.location]})]}),M.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid var(--border-color)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[M.jsx("span",{className:"text-primary",style:{fontSize:"0.875rem",fontWeight:600},children:E?"âœï¸ Edit & Manage â†’":"ðŸ“Š View & Contribute â†’"}),M.jsxs("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:["Created: ",new Date(e.createdAt).toLocaleDateString()]})]})]},e.id))}),!S&&0===o.length&&M.jsxs("div",{className:"flex-center",style:{minHeight:"40vh",flexDirection:"column",textAlign:"center"},children:[M.jsx("div",{style:{color:"var(--text-muted)",marginBottom:"1.5rem"},children:M.jsx(G,{size:64,opacity:.2})}),M.jsx("h3",{className:"text-secondary",children:"No Projects Found"}),M.jsx("p",{className:"text-muted mb-md",children:"Get started by creating your first construction project."}),E&&M.jsxs("button",{onClick:()=>u(!0),className:"btn btn-primary",children:[M.jsx(K,{size:18})," Create Project"]})]})]})}),ue=r.memo(({rowId:t,colId:s,value:n,type:a,onUpdate:i,isReadOnly:o})=>{const[l,d]=e.useState(n),c=r.useRef(null);e.useEffect(()=>{d(n)},[n]);return M.jsx("input",{type:"number"===a?"number":"text",value:l||"",onChange:e=>{if(o)return void e.preventDefault();const r=e.target.value;d(r),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{i(t,s,r)},800)},onBlur:()=>{o||c.current&&(clearTimeout(c.current),i(t,s,l))},onKeyDown:e=>{o&&e.preventDefault()},disabled:o,readOnly:o,title:o?"ðŸ”’ CEO-managed field (Read-only)":"",style:{width:"100%",background:o?"rgba(100, 116, 139, 0.08)":"transparent",border:"none",padding:"4px 0",cursor:o?"not-allowed":"text",opacity:o?.6:1,fontSize:"0.9375rem",color:o?"var(--text-muted)":"var(--text-main)",fontWeight:o?600:400}})}),me=r.memo(({row:e,columns:t,onUpdate:s,onDelete:n,onUpload:a,isUploading:i,isCEOUser:o,dailyTotalCell:l})=>{const d=!o&&"CEO"===e.createdByRole,c=o||!d,u=r.useRef(null);return M.jsxs("tr",{style:{background:o?"transparent":"rgba(100, 200, 255, 0.02)"},children:[t.filter(e=>"dailyTotal"!==e.id).map(t=>{const r=e.cellCreators?.[t.id],n=!o&&("CEO"===t.createdByRole||"CEO"===r);return M.jsx("td",{children:M.jsx(ue,{rowId:e.id,colId:t.id,value:e[t.id],type:t.type,onUpdate:s,isReadOnly:n})},`${e.id}-${t.id}`)}),l,M.jsx("td",{children:e.receiptUrl?M.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[M.jsx("a",{href:e.receiptUrl,target:"_blank",rel:"noopener noreferrer",style:{display:"block"},children:(e=>{if(!e)return!1;const t=e.toLowerCase();return t.includes(".jpg")||t.includes(".jpeg")||t.includes(".png")||t.includes(".gif")||t.includes(".webp")||t.includes("alt=media")})(e.receiptUrl)?M.jsx("img",{src:e.receiptUrl,alt:"Receipt",style:{width:"32px",height:"32px",objectFit:"cover",borderRadius:"4px",border:"1px solid var(--glass-border)",cursor:"zoom-in"},onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/32?text=ðŸ“„"}}):M.jsx("div",{style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-secondary)",borderRadius:"4px",fontSize:"1.2rem"},children:"ðŸ“„"})}),M.jsx("a",{href:e.receiptUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary",style:{fontSize:"0.75rem",fontWeight:"bold"},children:"View"})]}):M.jsxs("label",{style:{cursor:c&&!i?"pointer":"not-allowed",fontSize:"0.8rem",color:c?"var(--text-secondary)":"var(--text-muted)",opacity:c?1:.5,display:"flex",alignItems:"center",gap:"4px"},onClick:()=>{c&&!i&&u.current&&u.current.click()},children:[i?M.jsx("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:M.jsx("span",{className:"loading-spinner-small"})}):M.jsxs(M.Fragment,{children:[M.jsx(Q,{})," ",M.jsx("span",{style:{marginLeft:"4px"},children:"Upload"})]}),c&&M.jsx("input",{ref:u,type:"file",style:{display:"none"},accept:"image/*,application/pdf",onChange:t=>{t.target.files&&t.target.files[0]&&(a(e.id,t.target.files[0]),t.target.value="")},disabled:i})]})}),M.jsx("td",{children:o?M.jsx("button",{onClick:()=>n(e.id),className:"btn btn-danger btn-small",title:"Delete Row",children:M.jsx(J,{})}):M.jsx("button",{onClick:()=>n(e.id),className:"btn btn-danger btn-small",title:"Delete Your Expense Row",children:M.jsx(J,{})})})]})}),pe=r.memo(({site:t,onBack:s,user:n,isCEO:a})=>{const[i,o]=e.useState([]),[d,c]=e.useState([]),[u,m]=e.useState(!0),[p,x]=e.useState(""),[E,I]=e.useState(""),[B,O]=e.useState(""),[_,z]=e.useState(!1),[D,R]=e.useState(!1),[T,L]=e.useState(!1),[A,P]=e.useState(""),[F,U]=e.useState({}),$=a(),Y=r.useRef(null);e.useEffect(()=>{try{Y.current=new BroadcastChannel(`expenses_${t.id}`),Y.current.onmessage=e=>{}}catch(e){}return()=>{Y.current&&Y.current.close()}},[t.id]),e.useEffect(()=>{const e=f(l(W,"sites",t.id),e=>{if(e.exists()){const t=e.data(),r=t.expenses||{},s=[{id:"item",name:"Item Description",type:"text",width:"200px",createdByRole:"SYSTEM"},{id:"date",name:"Date",type:"text",width:"120px",createdByRole:"SYSTEM"},{id:"amount",name:"Amount (â‚¹)",type:"number",width:"120px",createdByRole:"SYSTEM"},{id:"dailyTotal",name:"Daily Total",type:"number",width:"120px",createdByRole:"SYSTEM"}],n=(t.expenseColumns||r.columns||s).map(e=>({...e,createdByRole:e.createdByRole||"SYSTEM"}));c(n),x(t.ceoBudget||r.ceoBudget||""),I(t.ceoProjectValue||r.ceoProjectValue||"")}});return()=>e()},[t.id]),e.useEffect(()=>{const e=h(j(W,"sites",t.id,"expenses"),y("createdAt","desc"),g(500)),r=f(e,e=>{const t=e.docs.map(e=>{const t=e.data();return t.cellCreators||(t.cellCreators={},t.createdByRole&&Object.keys(t).forEach(e=>{"id"!==e&&"createdAt"!==e&&"updatedAt"!==e&&"createdByRole"!==e&&"lastUpdatedByRole"!==e&&"cellCreators"!==e&&t[e]&&(t.cellCreators[e]=t.createdByRole)})),{id:e.id,...t}});o(t),m(!1)},e=>{m(!1),alert("âš ï¸ Failed to load expenses. Please check your connection.")});return()=>r()},[t.id]);const H=e.useCallback(async(e,r)=>{try{await b(j(W,"audit_logs"),{action:e,details:r,siteId:t.id,siteName:t.name,userId:n.uid,userEmail:n.email,timestamp:w()})}catch(s){}},[t.id,t.name,n.uid,n.email]),q=e.useCallback(async(e,r,s)=>{R(!0);const n=l(W,"sites",t.id);try{await S(n,{expenseColumns:e,ceoBudget:r,ceoProjectValue:s}),H("UPDATE_METADATA",{budget:r,projectValue:s})}catch(a){alert("Failed to save changes.")}R(!1)},[t.id,H]),Q=e.useCallback(async(e,r,s)=>{const a=i.find(t=>t.id===e),d=a?.cellCreators?.[r];if(!$&&"CEO"===d)return;if("amount"===r&&s&&isNaN(parseFloat(s)))return void alert("âŒ Amount must be a valid number");const c=$?"CEO":n.role;o(t=>t.map(t=>t.id===e?{...t,[r]:s,lastUpdatedByRole:n.role,cellCreators:{...t.cellCreators,[r]:c}}:t));try{if(await S(l(W,"sites",t.id,"expenses",e),{[r]:s,lastUpdatedByRole:n.role,cellCreators:{...a?.cellCreators||{},[r]:c},updatedAt:w()}),Y.current)try{Y.current.postMessage({type:"cell_updated",rowId:e,colId:r,value:s,updatedBy:n.email,timestamp:(new Date).toISOString()})}catch(u){}}catch(m){alert("âŒ Failed to save "+r+". Please try again."),o(t=>t.map(t=>t.id===e?{...t,[r]:a[r]}:t))}},[t.id,n.role,$,i]),ee=e.useCallback(async e=>{if(!e)return;const r=i.find(t=>t.id===e);if($||"CEO"!==r?.createdByRole){if(window.confirm("Delete this expense row?"))try{await v(l(W,"sites",t.id,"expenses",e)),H("DELETE_EXPENSE",{expenseId:e})}catch(s){alert("Failed to delete row: "+s.message)}}else alert("âŒ You can only delete rows you created. CEO-created rows cannot be deleted by members.")},[t.id,H,$,i]),se=e.useCallback(async(e,r)=>{if(!r)return;if(!V)return void alert("âŒ Storage not configured. Please check your Firebase settings.");if(["image/jpeg","image/png","image/gif","image/webp","application/pdf"].includes(r.type))if(r.size>10485760)alert("âŒ File size exceeds 10MB limit");else{U(t=>({...t,[e]:!0}));try{const s=r.name.split(".").pop(),n=`${Date.now()}_${Math.random().toString(36).substring(7)}.${s}`,a=C(V,`receipts/${t.id}/${e}/${n}`);await N(a,r);const i=await k(a),d={receiptUrl:i,receiptName:r.name,receiptSize:r.size,receiptType:r.type,uploadedAt:w(),updatedAt:w()};await S(l(W,"sites",t.id,"expenses",e),d),o(t=>t.map(t=>t.id===e?{...t,receiptUrl:i,receiptName:r.name,receiptSize:r.size,receiptType:r.type}:t)),H("UPLOAD_RECEIPT",{expenseId:e,fileName:r.name,fileSize:r.size}),alert("âœ… Receipt uploaded successfully!")}catch(s){s.message.includes("retry-limit-exceeded")||"storage/not-initialized"===s.code?alert("âš ï¸ Storage Connection Failed!\n\nThis usually means:\n1. Storage is NOT enabled in Firebase Console (Most Likely).\n2. Storage Rules are blocking the upload.\n\nPlease go to Firebase Console > Storage and click 'Get Started'."):"storage/unauthorized"===s.code?alert("âŒ Permission denied. Make sure Firebase Storage Rules allow uploads."):alert("âŒ Upload failed: "+s.message)}finally{U(t=>({...t,[e]:!1}))}}else alert("âŒ Only images (JPG, PNG, GIF, WebP) and PDF files are allowed")},[t.id,H]),ne=e.useMemo(()=>{if(!A)return i;const e=A.toLowerCase();return i.filter(t=>Object.values(t).some(t=>t&&String(t).toLowerCase().includes(e)))},[i,A]),ae=e.useMemo(()=>{const e={};return ne.forEach(t=>{const r=t.date||"No Date";e[r]||(e[r]=[]),e[r].push(t)}),Object.keys(e).sort((e,t)=>{if("No Date"===e)return 1;if("No Date"===t)return-1;const[r,s,n]=e.split("/").map(Number),[a,i,o]=t.split("/").map(Number);return new Date(o,i-1,a)-new Date(n,s-1,r)}).map(t=>{const r=e[t].reduce((e,t)=>e+(parseFloat(t.amount)||0),0);return{date:t,rows:e[t].map(e=>({...e,dailyTotal:r})),subtotal:r}})},[ne]),de=e.useMemo(()=>ne.reduce((e,t)=>e+(parseFloat(t.amount)||0),0),[ne]),ce=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),ue=parseFloat(p)||0,pe=e.useMemo(()=>ue>0?de/ue*100:0,[de,ue]),xe=ue-de;return M.jsxs("div",{className:"container fade-in",style:{paddingTop:"2rem",paddingBottom:"4rem"},children:[M.jsxs("header",{className:"flex-between mb-lg",style:{alignItems:"center",borderBottom:"1px solid var(--border-color)",paddingBottom:"1.5rem"},children:[M.jsxs("div",{className:"flex gap-md",style:{alignItems:"center"},children:[M.jsx("button",{onClick:s,className:"btn btn-secondary",style:{padding:"8px"},children:M.jsx(ie,{size:20})}),M.jsxs("div",{children:[M.jsxs("div",{className:"flex gap-sm",style:{alignItems:"center"},children:[M.jsx("div",{style:{color:"var(--accent-color)"},children:M.jsx(G,{size:24})}),M.jsx("h2",{style:{margin:0},children:t.name})]}),M.jsxs("p",{className:"text-secondary",style:{fontSize:"0.875rem",marginTop:"2px"},children:[M.jsx(oe,{size:14})," ",t.location]})]})]}),M.jsx("div",{className:"flex gap-sm",children:M.jsxs("button",{onClick:()=>{if(0===i.length)return void alert("No data to export");const e=[d.map(e=>e.name).join(","),...i.map(e=>d.map(t=>{const r=e[t.id]||"";return`"${String(r).replace(/"/g,'""')}"`}).join(","))].join("\n"),r=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(r),s.download=`${t.name}_expenses_${(new Date).toISOString().split("T")[0]}.csv`,s.click(),H("EXPORT_CSV",{})},className:"btn btn-secondary",children:[M.jsx(X,{size:18})," Export Data"]})})]}),M.jsxs("section",{className:"card mb-lg",style:{background:"var(--primary-color)",color:"white",border:"none"},children:[M.jsxs("div",{className:"flex-between mb-md",children:[M.jsxs("h3",{style:{color:"white",margin:0,display:"flex",alignItems:"center",gap:"8px"},children:[M.jsx(te,{size:20})," Project Financials"]}),$&&M.jsxs("div",{className:"flex gap-sm align-center",children:[T&&M.jsx("span",{className:"fade-in",style:{fontSize:"0.75rem",color:"var(--success-color)",fontWeight:600},children:"Changes Saved"}),M.jsx("button",{onClick:()=>{q(d,p,E),L(!0),setTimeout(()=>L(!1),3e3)},className:"btn btn-success",style:{padding:"6px 12px",fontSize:"0.75rem"},children:"Update Budget"})]})]}),M.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"2rem"},children:[M.jsxs("div",{className:"input-group",style:{marginBottom:0},children:[M.jsx("label",{style:{color:"rgba(255,255,255,0.7)"},children:"Total Project Value"}),$?M.jsx("input",{type:"number",value:E,onChange:e=>I(e.target.value),style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white"},placeholder:"Enter value..."}):M.jsx("div",{style:{fontSize:"1.25rem",fontWeight:700},children:ce(E)})]}),M.jsxs("div",{className:"input-group",style:{marginBottom:0},children:[M.jsx("label",{style:{color:"rgba(255,255,255,0.7)"},children:"Project Budget"}),$?M.jsx("input",{type:"number",value:p,onChange:e=>x(e.target.value),style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",color:"white"},placeholder:"Enter budget..."}):M.jsx("div",{style:{fontSize:"1.25rem",fontWeight:700},children:ce(p)})]}),M.jsxs("div",{children:[M.jsx("label",{style:{color:"rgba(255,255,255,0.7)",fontSize:"0.875rem",fontWeight:500,display:"block",marginBottom:"0.375rem"},children:"Total Expenditure"}),M.jsx("div",{style:{fontSize:"1.25rem",fontWeight:700},children:ce(de)})]}),M.jsxs("div",{children:[M.jsx("label",{style:{color:"rgba(255,255,255,0.7)",fontSize:"0.875rem",fontWeight:500,display:"block",marginBottom:"0.375rem"},children:"Remaining Balance"}),M.jsx("div",{style:{fontSize:"1.25rem",fontWeight:700,color:xe<0?"#fda4af":"#6ee7b7"},children:ce(xe)})]})]}),ue>0&&M.jsxs("div",{style:{marginTop:"2rem"},children:[M.jsxs("div",{className:"flex-between mb-sm",children:[M.jsx("span",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.7)"},children:"Budget Utilization"}),M.jsxs("span",{style:{fontSize:"0.875rem",fontWeight:600},children:[Math.round(pe),"%"]})]}),M.jsx("div",{className:"progress-container",style:{background:"rgba(255,255,255,0.1)",height:"10px"},children:M.jsx("div",{className:"progress-bar",style:{width:`${Math.min(pe,100)}%`,backgroundColor:pe>100?"var(--danger-color)":"var(--success-color)"}})})]})]}),M.jsxs("section",{children:[M.jsxs("div",{className:"flex-between mb-md",children:[M.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[M.jsx(le,{size:20})," Expense Ledger"]}),M.jsxs("div",{className:"flex gap-sm",children:[M.jsxs("div",{style:{position:"relative",width:"280px"},children:[M.jsx("div",{style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"var(--text-muted)"},children:M.jsx(Z,{size:16})}),M.jsx("input",{type:"text",placeholder:"Search ledger...",value:A,onChange:e=>P(e.target.value),style:{paddingLeft:"34px",paddingRight:"10px",height:"38px"}})]}),M.jsxs("button",{onClick:()=>z(!0),className:"btn btn-secondary",style:{height:"38px"},children:[M.jsx(K,{size:16})," Column"]}),M.jsxs("button",{onClick:async()=>{try{const e=(new Date).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}),r={createdAt:w(),createdByRole:n.role,cellCreators:{}};d.forEach(t=>{"date"===t.id?(r[t.id]=e,r.cellCreators[t.id]=n.role):(r[t.id]="",r.cellCreators[t.id]=n.role)});const s=await b(j(W,"sites",t.id,"expenses"),r);H("ADD_EXPENSE",{expenseId:s.id,role:n.role})}catch(e){alert("Failed to add row.")}},className:"btn btn-primary",style:{height:"38px"},children:[M.jsx(K,{size:16})," Add Row"]})]})]}),!$&&d.some(e=>"CEO"===e.createdByRole)&&M.jsx("div",{style:{background:"rgba(59, 130, 246, 0.05)",border:"1px solid rgba(59, 130, 246, 0.2)",borderRadius:"8px",padding:"12px 16px",marginBottom:"1.5rem",fontSize:"0.875rem",color:"var(--text-secondary)"},children:M.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[M.jsx("span",{children:"ðŸ”’"}),"Some columns are managed by the CEO and are read-only. You can edit other fields and add new rows."]})}),M.jsx("div",{className:"table-container",children:M.jsxs("table",{children:[M.jsx("thead",{children:M.jsxs("tr",{children:[d.map(e=>M.jsx("th",{style:{width:e.width},children:M.jsxs("div",{className:"flex-between",children:[M.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.name,"CEO"===e.createdByRole&&!$&&M.jsx("span",{title:"This field is managed by CEO - read-only",style:{color:"var(--danger-color)",fontSize:"0.85rem"},children:"ðŸ”’"})]}),$&&"item"!==e.id&&"amount"!==e.id&&"date"!==e.id&&"dailyTotal"!==e.id&&M.jsx("button",{onClick:()=>(e=>{if("item"===e||"amount"===e||"date"===e||"dailyTotal"===e)return void alert("Cannot delete default columns");const t=d.find(t=>t.id===e);if($||"CEO"!==t?.createdByRole){if(confirm("Delete this column definition?")){const t=d.filter(t=>t.id!==e);c(t),q(t,p,E),H("DELETE_COLUMN",{columnId:e})}}else alert("âŒ Only a CEO can delete CEO-created columns")})(e.id),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:M.jsx(J,{size:14})})]})},e.id)),M.jsx("th",{style:{width:"120px"},children:"Receipt"}),M.jsx("th",{style:{width:"80px",textAlign:"center"},children:"Actions"})]})}),M.jsx("tbody",{children:u?M.jsx("tr",{children:M.jsx("td",{colSpan:d.length+2,className:"text-center",style:{padding:"3rem"},children:M.jsx("div",{className:"loading-spinner",style:{margin:"0 auto"}})})}):0===ae.length?M.jsx("tr",{children:M.jsx("td",{colSpan:d.length+2,className:"text-center text-muted",style:{padding:"3rem"},children:A?"No expenses match your search":"No expenses recorded yet"})}):ae.map(e=>M.jsxs(r.Fragment,{children:[M.jsx("tr",{style:{background:"var(--bg-secondary)",borderLeft:"4px solid var(--accent-color)"},children:M.jsx("td",{colSpan:d.length+2,style:{padding:"8px 12px",fontSize:"0.8rem",fontWeight:600,color:"var(--text-secondary)"},children:M.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[M.jsx(re,{size:14})," ",e.date,M.jsxs("span",{style:{marginLeft:"auto",opacity:.7},children:["Daily Subtotal: ",ce(e.subtotal)]})]})})}),e.rows.map((t,r)=>M.jsx(me,{row:t,columns:d,onUpdate:Q,onDelete:ee,onUpload:se,isUploading:!!F[t.id],isCEOUser:$,dailyTotalCell:0===r?M.jsx("td",{rowSpan:e.rows.length,style:{verticalAlign:"middle",textAlign:"right",fontWeight:"bold",background:"rgba(var(--accent-rgb), 0.05)",borderLeft:"1px solid var(--border-color)",color:"var(--primary-color)"},children:ce(e.subtotal)}):null},t.id))]},e.date))}),ne.length>0&&M.jsx("tfoot",{children:M.jsxs("tr",{style:{background:"#f8fafc",fontWeight:"bold"},children:[M.jsx("td",{colSpan:d.findIndex(e=>"amount"===e.id),className:"text-right",children:"Total:"}),M.jsx("td",{children:ce(de)}),M.jsx("td",{colSpan:d.length-d.findIndex(e=>"amount"===e.id)+1})]})})]})})]}),_&&M.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.4)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:M.jsxs("div",{className:"card fade-in",style:{width:"100%",maxWidth:"400px"},children:[M.jsx("h3",{className:"mb-md",children:"Add Custom Column"}),M.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!B.trim())return;const t={id:`col_${Date.now()}`,name:B,type:"text",width:"150px",createdByRole:n.role},r=[...d,t];c(r),q(r,p,E),O(""),z(!1),H("ADD_COLUMN",{columnName:B,role:n.role})},children:[M.jsxs("div",{className:"input-group",children:[M.jsx("label",{children:"Column Name"}),M.jsx("input",{type:"text",placeholder:"e.g., Vendor, Date, Category",value:B,onChange:e=>O(e.target.value),autoFocus:!0,required:!0})]}),M.jsxs("div",{className:"flex gap-sm mt-lg",children:[M.jsx("button",{type:"submit",className:"btn btn-primary",style:{flex:1},children:"Add Column"}),M.jsx("button",{type:"button",onClick:()=>z(!1),className:"btn btn-secondary",style:{flex:1},children:"Cancel"})]})]})]})})]})}),xe=()=>M.jsxs("div",{className:"flex-center",style:{minHeight:"100vh",flexDirection:"column"},children:[M.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem",animation:"pulse 1.5s infinite"},children:"ðŸ—ï¸"}),M.jsx("h2",{children:"Loading..."}),M.jsx("p",{className:"text-muted",style:{marginBottom:"1.5rem"},children:"Connecting to construction database..."}),M.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-secondary btn-small",style:{opacity:.7},children:"ðŸ”„ Refresh App"})]}),he=()=>{const{user:t,loading:r,isCEO:s}=Y(),[n,a]=e.useState(null);return r?M.jsx(xe,{}):t?n?M.jsx(pe,{site:n,onBack:()=>{a(null)},user:t,isCEO:s}):M.jsx(ce,{onSelectSite:e=>{a(e)}}):M.jsx(de,{})};function ge(){return M.jsx(H,{children:M.jsx(e.Suspense,{fallback:M.jsx(xe,{}),children:M.jsx(he,{})})})}L.createRoot(document.getElementById("root")).render(M.jsx(r.StrictMode,{children:M.jsx(ge,{})}));
